<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ring-Link - è¨­å®š</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box;-webkit-user-select:none;user-select:none}
  input,textarea,select{-webkit-user-select:text;user-select:text}
  body{background:#f4f5f7;font-family:'Segoe UI','Yu Gothic UI',sans-serif;color:#1a1a2e;min-height:100vh}
  .header{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:#fff;border-bottom:1px solid #e0e2e8;box-shadow:0 1px 3px rgba(0,0,0,0.04)}
  .header-title{display:flex;align-items:center;gap:10px;font-size:15px;font-weight:600;color:#4a6cf7}
  .header-right{display:flex;gap:8px}
  .header-btn{background:#f0f1f4;border:1px solid #dcdee4;color:#555;padding:5px 12px;border-radius:6px;cursor:pointer;font-size:12px;display:flex;align-items:center;gap:4px;transition:all .15s}
  .header-btn:hover{background:#e4e6ec;color:#333}
  .header-btn.primary{background:#4a6cf7;border-color:#3b5de7;color:#fff}
  .header-btn.primary:hover{background:#3b5de7}
  .layout{display:flex;height:calc(100vh - 49px)}
  .sidebar{width:200px;background:#fff;border-right:1px solid #e0e2e8;padding:12px 0;display:flex;flex-direction:column;flex-shrink:0}
  .sidebar-title{font-size:9px;color:#999;text-transform:uppercase;letter-spacing:1.5px;padding:0 14px;margin-bottom:8px}
  .tab-list{flex:1;overflow-y:auto}
  .tab-item{display:flex;align-items:center;gap:8px;padding:8px 14px;cursor:pointer;transition:all .15s;border-left:3px solid transparent}
  .tab-item:hover{background:#f0f2f8}
  .tab-item.active{background:#eef1ff;border-left-color:#4a6cf7}
  .tab-item-icon{font-size:16px}
  .tab-item-name{flex:1;font-size:12px;color:#555}
  .tab-item.active .tab-item-name{color:#4a6cf7;font-weight:500}
  .tab-item-key{font-size:9px;color:#aaa;background:#f0f1f4;border:1px solid #e0e2e8;border-radius:3px;padding:1px 4px}
  .tab-item.active .tab-item-key{color:#4a6cf7;background:#e0e6ff;border-color:#c0ccff}
  .tab-move-btns{display:flex;flex-direction:column;gap:1px;margin-left:auto;flex-shrink:0}
  .tab-move-btn{width:18px;height:14px;border:1px solid #ddd;border-radius:3px;background:#f8f9fb;cursor:pointer;font-size:8px;display:flex;align-items:center;justify-content:center;color:#999;line-height:1}
  .tab-move-btn:hover{background:#e0e6ff;color:#4a6cf7;border-color:#b0c0ff}
  .tab-add-btn{margin:6px 12px;padding:7px;border:1px dashed #ccc;border-radius:6px;text-align:center;font-size:11px;color:#999;cursor:pointer}
  .tab-add-btn:hover{border-color:#4a6cf7;color:#4a6cf7;background:#f8f9ff}
  .sidebar-nav{border-top:1px solid #e0e2e8;margin-top:auto;padding-top:8px}
  .main{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0}
  .edit-header{padding:14px 20px 0;display:flex;align-items:center;gap:14px;flex-shrink:0}
  .edit-tab-icon{width:42px;height:42px;border-radius:10px;background:#eef1ff;border:1px solid #d0d8ff;display:flex;align-items:center;justify-content:center;font-size:22px;cursor:pointer}
  .edit-tab-icon:hover{background:#e0e6ff}
  .edit-tab-name-input{background:transparent;border:none;border-bottom:2px solid #e0e2e8;color:#1a1a2e;font-size:18px;font-weight:600;padding:2px 0;width:240px;outline:none}
  .edit-tab-name-input:focus{border-bottom-color:#4a6cf7}
  .edit-tab-desc{font-size:10px;color:#999;margin-top:2px}
  .edit-tab-actions{display:flex;gap:6px;margin-left:auto}
  .btn{padding:5px 10px;border-radius:5px;font-size:11px;cursor:pointer;transition:all .15s;border:1px solid;display:flex;align-items:center;gap:4px}
  .btn-danger{background:#fff0f0;border-color:#fcc;color:#e44}
  .btn-danger:hover{background:#ffe0e0}
  .btn-secondary{background:#f0f1f4;border-color:#dcdee4;color:#666}
  .btn-secondary:hover{background:#e4e6ec;color:#333}
  .btn-primary{background:#4a6cf7;border-color:#3b5de7;color:#fff}
  .btn-primary:hover{background:#3b5de7}
  .edit-content{flex:1;overflow-y:auto;padding:14px 20px}
  .content-label{font-size:10px;color:#999;text-transform:uppercase;letter-spacing:1px;margin-bottom:10px}
  .sector-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  .sector-card{background:#fff;border:2px solid #e0e2e8;border-radius:10px;padding:12px 8px;cursor:pointer;position:relative;transition:all .15s;position:relative;min-height:110px;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 1px 3px rgba(0,0,0,0.04)}
  .sector-card:hover{border-color:#b0bcff;box-shadow:0 2px 8px rgba(74,108,247,0.1)}
  .sector-card.editing{border-color:#4a6cf7;background:#f8f9ff;box-shadow:0 2px 12px rgba(74,108,247,0.15)}
  .sector-card.drag-over{border-color:#4caf50;background:#f0faf0;border-style:dashed;transform:scale(1.03)}
  .sector-card-num{position:absolute;top:6px;left:8px;font-size:9px;color:#bbb;font-weight:700}
  .sector-card-pos{position:absolute;top:6px;right:8px;font-size:9px;color:#bbb}
  .sector-card-icon{font-size:28px;margin:4px 0}
  .sector-card-icon img{width:32px;height:32px;object-fit:contain}
  .sector-card-label{font-size:11px;color:#555;margin-bottom:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:100%}
  .sector-card-type-wrap{text-align:center}
  .sector-swap-btns{position:absolute;top:2px;right:2px;display:flex;gap:1px}
  .sector-swap-btn{width:18px;height:16px;border:1px solid #ddd;border-radius:3px;background:#f8f9fb;cursor:pointer;font-size:8px;display:flex;align-items:center;justify-content:center;color:#999}
  .sector-swap-btn:hover{background:#e0e6ff;color:#4a6cf7;border-color:#b0c0ff}
  .sector-card-type{font-size:9px;padding:1px 6px;border-radius:3px;display:inline-block}
  .type-launch{background:#e8f5e9;color:#2e7d32}.type-clipboard{background:#fff3e0;color:#e65100}.type-templates{background:#f3e5f5;color:#7b1fa2}.type-text{background:#e3f2fd;color:#1565c0}.type-screenshot{background:#fce4ec;color:#c62828}
  .sector-card.empty{border-style:dashed;border-color:#ddd;background:#fafafa;box-shadow:none}
  .sector-card.empty:hover{border-color:#4a6cf7;background:#f8f9ff}
  .empty-icon{font-size:20px;color:#ccc}.empty-text{font-size:10px;color:#bbb;margin-top:2px}
  .edit-panel{margin-top:12px;background:#fff;border:1px solid #d0d8ff;border-radius:10px;padding:16px;box-shadow:0 2px 8px rgba(74,108,247,0.08)}
  .edit-panel-title{font-size:13px;font-weight:600;color:#4a6cf7;margin-bottom:12px}
  .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .form-group{display:flex;flex-direction:column;gap:4px}
  .form-label{font-size:10px;color:#888;text-transform:uppercase;letter-spacing:.5px}
  .form-input{background:#f8f9fc;border:1px solid #dcdee4;border-radius:5px;color:#333;padding:6px 10px;font-size:12px;outline:none}
  .form-input:focus{border-color:#4a6cf7;background:#fff}
  .form-select{background:#f8f9fc;border:1px solid #dcdee4;border-radius:5px;color:#333;padding:6px 10px;font-size:12px;outline:none;cursor:pointer}
  .form-textarea{background:#f8f9fc;border:1px solid #dcdee4;border-radius:5px;color:#333;padding:6px 10px;font-size:12px;outline:none;resize:vertical;min-height:60px;font-family:inherit}
  .form-textarea:focus{border-color:#4a6cf7;background:#fff}
  .panel-actions{display:flex;justify-content:flex-end;gap:6px;margin-top:12px;padding-top:10px;border-top:1px solid #eee}
  .palette{width:270px;background:#fff;border-left:1px solid #e0e2e8;display:flex;flex-direction:column;flex-shrink:0;overflow:hidden}
  .palette-header{padding:12px 14px;font-size:12px;font-weight:600;color:#4a6cf7;border-bottom:1px solid #e0e2e8}
  .palette-tabs{display:flex;border-bottom:1px solid #e0e2e8}
  .palette-tab{flex:1;padding:7px 0;text-align:center;font-size:11px;color:#999;cursor:pointer;border-bottom:2px solid transparent;transition:all .15s}
  .palette-tab:hover{color:#555}
  .palette-tab.active{color:#4a6cf7;border-bottom-color:#4a6cf7}
  .palette-content{flex:1;overflow-y:auto;padding:8px}
  .palette-item{display:flex;align-items:center;gap:8px;padding:8px 10px;margin-bottom:4px;background:#f8f9fc;border:1px solid #e8eaef;border-radius:7px;cursor:grab;transition:all .15s}
  .palette-item:hover{background:#eef1ff;border-color:#c0ccff}
  .palette-item.dragging{opacity:.4}
  .palette-item-icon{font-size:18px;flex-shrink:0}
  .palette-item-info{flex:1;min-width:0}
  .palette-item-name{font-size:11px;color:#444;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .palette-item-desc{font-size:9px;color:#aaa;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:1px}
  .palette-item-badge{font-size:8px;padding:1px 5px;border-radius:3px;flex-shrink:0}
  .palette-section-title{font-size:9px;color:#999;text-transform:uppercase;letter-spacing:1px;padding:8px 4px 4px;display:flex;align-items:center;justify-content:space-between}
  .palette-add-btn{font-size:9px;color:#4a6cf7;cursor:pointer;padding:2px 6px;border-radius:3px}
  .palette-add-btn:hover{background:#eef1ff}
  .screenshot-card{display:flex;align-items:center;gap:10px;padding:10px 12px;margin-bottom:6px;background:#fef5f7;border:1px solid #f8d0d8;border-radius:8px;cursor:grab;transition:all .15s}
  .screenshot-card:hover{background:#fdeaef;border-color:#f0a0b0}
  .screenshot-card-icon{font-size:22px}.screenshot-card-info{flex:1}.screenshot-card-name{font-size:12px;color:#c62828;font-weight:500}.screenshot-card-desc{font-size:9px;color:#b77;margin-top:1px}
  .screenshot-card-badge{font-size:8px;padding:2px 6px;border-radius:3px;background:#fce4ec;color:#c62828}
  .drop-zone{margin:4px 0 8px;padding:16px 10px;border:2px dashed #ccc;border-radius:8px;text-align:center;transition:all .2s;cursor:pointer}
  .drop-zone:hover,.drop-zone.drag-active{border-color:#4caf50;background:#f0faf0}
  .drop-zone-icon{font-size:28px;margin-bottom:4px}.drop-zone-main{font-size:11px;color:#777;margin-bottom:2px}.drop-zone-sub{font-size:9px;color:#aaa;line-height:1.5}
  .dialog-btns{display:flex;gap:4px;margin:4px 0 8px}
  .dialog-btn{flex:1;padding:8px;border:1px solid #dcdee4;border-radius:7px;background:#f8f9fc;cursor:pointer;text-align:center;font-size:11px;color:#555;transition:all .15s}
  .dialog-btn:hover{background:#eef1ff;border-color:#4a6cf7;color:#4a6cf7}
  .registered-item{display:flex;align-items:center;gap:8px;padding:7px 10px;margin-bottom:4px;background:#f8f9fc;border:1px solid #e8eaef;border-radius:7px;cursor:grab;transition:all .15s}
  .registered-item:hover{background:#eef1ff;border-color:#c0ccff}
  .registered-item-icon{font-size:16px;flex-shrink:0}.registered-item-icon img{width:20px;height:20px;object-fit:contain;vertical-align:middle}.registered-item-info{flex:1;min-width:0}
  .registered-item-name{font-size:11px;color:#444;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .registered-item-path{font-size:8px;color:#aaa;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:1px;font-family:monospace}
  .registered-item-del{background:none;border:none;color:#ccc;cursor:pointer;font-size:12px;padding:2px;border-radius:3px}
  .registered-item-del:hover{color:#e44;background:#fff0f0}
  .new-template-wrap{margin-top:6px;padding:8px;background:#f0f2ff;border:1px solid #d0d8ff;border-radius:7px;display:none}
  .new-template-wrap.visible{display:block}
  .new-template-input{width:100%;background:#fff;border:1px solid #dcdee4;border-radius:4px;color:#333;padding:6px 8px;font-size:11px;outline:none;resize:vertical;min-height:50px;font-family:inherit}
  .new-template-actions{display:flex;gap:4px;margin-top:6px;justify-content:flex-end}
  .drag-ghost{position:fixed;pointer-events:none;z-index:1000;background:#4a6cf7;border-radius:8px;padding:6px 12px;font-size:11px;color:#fff;box-shadow:0 4px 16px rgba(74,108,247,0.3);display:none;max-width:200px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(20px);background:#4a6cf7;color:white;padding:8px 20px;border-radius:7px;font-size:12px;font-weight:500;opacity:0;transition:all .3s;pointer-events:none;z-index:200}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
  .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.3);z-index:100;display:none;align-items:center;justify-content:center}
  .modal-overlay.visible{display:flex}
  .modal{background:#fff;border:1px solid #d0d8ff;border-radius:12px;padding:20px;width:360px;box-shadow:0 20px 50px rgba(0,0,0,0.15)}
  .modal-title{font-size:14px;font-weight:600;color:#4a6cf7;margin-bottom:12px}
  .emoji-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:3px;max-height:250px;overflow-y:auto}
  .emoji-btn{width:34px;height:34px;border:none;background:#f8f9fc;border-radius:6px;font-size:18px;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center}
  .emoji-btn:hover{background:#eef1ff;transform:scale(1.15)}
  .modal-actions{display:flex;justify-content:flex-end;gap:6px;margin-top:12px}
  .browse-modal{width:440px}
  .browse-input{width:100%;background:#f8f9fc;border:1px solid #dcdee4;border-radius:5px;color:#333;padding:7px 10px;font-size:12px;outline:none;font-family:monospace;margin-bottom:8px}
  .browse-input:focus{border-color:#4a6cf7;background:#fff}
  .browse-name-row{display:flex;gap:6px;align-items:center;margin-bottom:8px}
  .browse-label{font-size:10px;color:#888;min-width:50px}
  .preview-float{position:fixed;bottom:14px;right:284px;width:130px;height:130px;background:#fff;border:1px solid #e0e2e8;border-radius:14px;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 12px rgba(0,0,0,0.06)}
  .preview-float-label{position:absolute;bottom:-18px;font-size:9px;color:#bbb;text-align:center;width:100%}
  .preview-svg{width:110px;height:110px}
  .preview-sector{fill:#f0f2f8;stroke:#d0d4e0;stroke-width:.8}.preview-sector.highlight{fill:#dce3ff;stroke:#4a6cf7}
  .setting-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f0f1f4}
  .setting-label-group{display:flex;flex-direction:column;gap:1px}.setting-label{font-size:12px;color:#444}.setting-desc{font-size:10px;color:#aaa}
  .toggle{width:38px;height:20px;background:#ddd;border-radius:10px;cursor:pointer;position:relative;transition:background .3s}.toggle.on{background:#4a6cf7}
  .toggle-knob{width:16px;height:16px;background:#fff;border-radius:50%;position:absolute;top:2px;left:2px;transition:all .3s;box-shadow:0 1px 3px rgba(0,0,0,0.15)}.toggle.on .toggle-knob{left:20px}
  .setting-number{width:55px;background:#f8f9fc;border:1px solid #dcdee4;border-radius:5px;color:#333;padding:4px 6px;font-size:12px;text-align:center;outline:none}
  .setting-select{background:#f8f9fc;border:1px solid #dcdee4;border-radius:5px;color:#333;padding:4px 8px;font-size:12px;outline:none;cursor:pointer}
  .hotkey-row{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid #f0f1f4}
  .hotkey-label{font-size:12px;color:#444;flex:1}
  .hotkey-input{background:#f8f9fc;border:1px solid #dcdee4;border-radius:5px;color:#4a6cf7;padding:5px 12px;font-size:11px;font-weight:600;text-align:center;min-width:140px;cursor:pointer;transition:all .2s}
  .hotkey-input:hover{border-color:#4a6cf7;background:#f0f2ff}
  .hotkey-input.recording{border-color:#f90;color:#f90;animation:pulse 1s infinite}
  @keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(255,153,0,.2)}50%{box-shadow:0 0 0 5px rgba(255,153,0,0)}}
  .status-bar{padding:6px 20px;background:#fff;border-top:1px solid #e0e2e8;font-size:10px;color:#aaa;display:flex;justify-content:space-between}
</style>
</head>
<body>
<div class="header"><div class="header-title">âš™ï¸ Ring-Link è¨­å®š</div><div class="header-right"><button class="header-btn" onclick="exportConfig()">ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button><button class="header-btn" onclick="importConfig()">ğŸ“¥ ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button><button class="header-btn primary" onclick="window.close()">âœ• é–‰ã˜ã‚‹</button></div></div>
<div class="layout">
  <div class="sidebar"><div class="sidebar-title">æ¥­å‹™ã‚¿ãƒ–</div><div class="tab-list" id="tabList"></div><div class="tab-add-btn" onclick="addNewTab()">ï¼‹ ã‚¿ãƒ–ã‚’è¿½åŠ </div><div class="sidebar-nav"><div class="sidebar-title">å…¨èˆ¬è¨­å®š</div><div class="tab-item" onclick="showView('hotkey')" id="navHotkey"><span class="tab-item-icon">âŒ¨ï¸</span><span class="tab-item-name">ãƒ›ãƒƒãƒˆã‚­ãƒ¼</span></div><div class="tab-item" onclick="showView('clipboard')" id="navClipboard"><span class="tab-item-icon">ğŸ“‹</span><span class="tab-item-name">ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰</span></div><div class="tab-item" onclick="showView('appearance')" id="navAppearance"><span class="tab-item-icon">ğŸ¨</span><span class="tab-item-name">å¤–è¦³ãƒ»ä¸€èˆ¬</span></div></div></div>
  <div class="main">
    <div id="tabEditView"><div class="edit-header"><div class="edit-tab-icon" id="editTabIcon" onclick="openEmojiPicker('tab')">âš™ï¸</div><div><input class="edit-tab-name-input" id="editTabName" value="" oninput="onTabNameChange()"><div class="edit-tab-desc">å³ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ã‚¹ãƒ­ãƒƒãƒˆã«é…ç½®</div></div><div class="edit-tab-actions"><button class="btn btn-secondary" onclick="duplicateTab()">ğŸ“„ è¤‡è£½</button><button class="btn btn-danger" onclick="deleteTab()">ğŸ—‘ï¸ å‰Šé™¤</button></div></div><div class="edit-content"><div class="content-label">ğŸ¯ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ­ãƒƒãƒˆï¼ˆ8å€‹ï¼‰</div><div id="sectorGridArea"></div></div></div>
    <div id="hotkeyView" style="display:none"><div class="edit-header"><div style="font-size:28px">âŒ¨ï¸</div><div><div style="font-size:18px;font-weight:600">ãƒ›ãƒƒãƒˆã‚­ãƒ¼è¨­å®š</div><div class="edit-tab-desc">ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ç™»éŒ²</div></div></div><div class="edit-content" id="hotkeyContent"></div></div>
    <div id="clipboardView" style="display:none"><div class="edit-header"><div style="font-size:28px">ğŸ“‹</div><div><div style="font-size:18px;font-weight:600">ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰è¨­å®š</div></div></div><div class="edit-content" id="clipboardContent"></div></div>
    <div id="appearanceView" style="display:none"><div class="edit-header"><div style="font-size:28px">ğŸ¨</div><div><div style="font-size:18px;font-weight:600">å¤–è¦³ãƒ»ä¸€èˆ¬è¨­å®š</div></div></div><div class="edit-content" id="appearanceContent"></div></div>
  </div>
  <div class="palette" id="palettePanel"><div class="palette-header">ğŸ§© ãƒ‘ãƒ¼ãƒ„ãƒ‘ãƒ¬ãƒƒãƒˆ</div><div class="palette-tabs"><div class="palette-tab active" data-pt="templates" onclick="switchPaletteTab(this)">å®šå‹æ–‡</div><div class="palette-tab" data-pt="launch" onclick="switchPaletteTab(this)">èµ·å‹•</div><div class="palette-tab" data-pt="system" onclick="switchPaletteTab(this)">ã‚·ã‚¹ãƒ†ãƒ </div></div><div class="palette-content" id="paletteContent"></div></div>
</div>
<div class="preview-float" id="previewFloat"><svg class="preview-svg" id="previewSvg" viewBox="0 0 110 110"></svg><div class="preview-float-label">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div></div>
<div class="drag-ghost" id="dragGhost"></div>
<div class="modal-overlay" id="emojiModal"><div class="modal"><div class="modal-title">ã‚¢ã‚¤ã‚³ãƒ³ã‚’é¸æŠ</div><div class="emoji-grid" id="emojiGrid"></div><div class="modal-actions"><button class="btn btn-secondary" onclick="closeEmojiPicker()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button></div></div></div>
<div class="modal-overlay" id="browseModal"><div class="modal browse-modal"><div class="modal-title">ğŸ“‚ ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ / ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç™»éŒ²</div><div style="font-size:11px;color:#888;margin-bottom:12px">ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã€ã¾ãŸã¯ãƒœã‚¿ãƒ³ã§é¸æŠ</div><div class="drop-zone" id="modalDropZone"><div class="drop-zone-icon">ğŸ“</div><div class="drop-zone-main">ãƒ•ã‚¡ã‚¤ãƒ« / ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã“ã“ã«ãƒ‰ãƒ­ãƒƒãƒ—</div></div><div class="dialog-btns"><div class="dialog-btn" onclick="dialogSelectFile('modal')">ğŸ“„ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</div><div class="dialog-btn" onclick="dialogSelectFolder('modal')">ğŸ“‚ ãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠ</div></div><div style="text-align:center;font-size:9px;color:#bbb;margin:4px 0">â”€â”€ ã¾ãŸã¯æ‰‹å‹•å…¥åŠ› â”€â”€</div><input class="browse-input" id="browsePathInput" placeholder="C:\Users\...\Desktop\app.lnk"><div class="browse-name-row"><span class="browse-label">è¡¨ç¤ºå</span><input class="browse-input" id="browseNameInput" placeholder="ã‚¢ãƒ—ãƒªå" style="margin:0"></div><div class="browse-name-row"><span class="browse-label">ã‚¢ã‚¤ã‚³ãƒ³</span><div style="display:flex;align-items:center;gap:8px"><div id="browseIconPreview" style="width:32px;height:32px;border-radius:6px;background:#f0f2f8;border:1px solid #ddd;display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer" onclick="openEmojiPicker('browse')">ğŸ“</div><span style="font-size:10px;color:#aaa">ã‚¯ãƒªãƒƒã‚¯å¤‰æ›´</span></div></div><div class="modal-actions"><button class="btn btn-secondary" onclick="closeBrowseModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button><button class="btn btn-primary" onclick="registerFromBrowse()">âœ… ç™»éŒ²</button></div></div></div>
<div class="status-bar"><span id="statusText">èª­ã¿è¾¼ã¿ä¸­...</span><span id="statusVersion"></span></div>
<div class="toast" id="toast"></div>
<script>
// Electronã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‰ãƒ­ãƒƒãƒ—æŒ™å‹•ã‚’å®Œå…¨ã«ç„¡åŠ¹åŒ–ï¼ˆãƒšãƒ¼ã‚¸é·ç§»é˜²æ­¢ï¼‰
document.addEventListener('dragover',e=>e.preventDefault(),true);
document.addEventListener('drop',e=>e.preventDefault(),true);

let configData=null,currentTabIndex=0,editingSectorIndex=-1,emojiTarget=null,currentPaletteTab='templates',browseIcon='ğŸ“';
const posNames=['ä¸Š','å³ä¸Š','å³','å³ä¸‹','ä¸‹','å·¦ä¸‹','å·¦','å·¦ä¸Š'];
const emojis=['ğŸ“','ğŸ“‚','ğŸ“„','ğŸ“‹','ğŸ“‘','ğŸ“','ğŸ“Š','ğŸ“ˆ','ğŸ“‰','ğŸ’°','ğŸ’³','ğŸ¦','ğŸ§®','ğŸ“§','ğŸ’¬','ğŸ“…','ğŸ”','âš™ï¸','â“','ğŸŒ','ğŸ“¦','ğŸšš','ğŸ“¸','ğŸ¨','ğŸ–¨ï¸','ğŸŒ','ğŸ®','ğŸ’»','ğŸ™','ğŸ§ª','ğŸ“–','ğŸ²','ğŸ¯','ğŸ”§','ğŸ”‘','ğŸ“Œ','â­','â¤ï¸','ğŸ””','ğŸ—‚ï¸','ğŸ’¼','ğŸ ','â˜ï¸','ğŸ–¥ï¸','âŒ¨ï¸','ğŸ–±ï¸','ğŸ”’','âœ…','âŒ','â•','âœï¸','ğŸ—‘ï¸','ğŸ’¡','ğŸš€','ğŸµ','ğŸ¥½','ğŸ“±','ğŸ–¼ï¸','ğŸ“','ğŸ’','ğŸ“·','âœ‚ï¸','ğŸ—ƒï¸'];
const systemItems=[{icon:'ğŸ“‹',label:'ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰å±¥æ­´',type:'clipboard',target:''},{icon:'ğŸ“‘',label:'å®šå‹æ–‡ä¸€è¦§',type:'templates',target:''},{icon:'ğŸ”',label:'ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢',type:'launch',target:'Everything.exe'},{icon:'âš™ï¸',label:'Ring-Linkè¨­å®š',type:'launch',target:'settings'},{icon:'ğŸ”’',label:'ç”»é¢ãƒ­ãƒƒã‚¯',type:'launch',target:'rundll32.exe user32.dll,LockWorkStation'}];
function iconHtml(iconOrData,size){size=size||28;if(iconOrData&&iconOrData.startsWith('data:image'))return '<img src="'+iconOrData+'" style="width:'+size+'px;height:'+size+'px;object-fit:contain">';return iconOrData||'ğŸ“';}
const hotkeyDefs=[{key:'toggleMenu',label:'ãƒ¡ãƒ‹ãƒ¥ãƒ¼å‘¼ã³å‡ºã—'},{key:'clipboardHistory',label:'ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰å±¥æ­´'},{key:'templateList',label:'å®šå‹æ–‡ä¸€è¦§'},{key:'screenshotClip',label:'ç¯„å›²ã‚­ãƒ£ãƒ—ãƒãƒ£ â†’ CLP'},{key:'screenshotSave',label:'ç¯„å›²ã‚­ãƒ£ãƒ—ãƒãƒ£ â†’ ä¿å­˜'},{key:'openSettings',label:'è¨­å®šç”»é¢ã‚’é–‹ã'},{key:'nextTab',label:'æ¬¡ã®ã‚¿ãƒ–'},{key:'prevTab',label:'å‰ã®ã‚¿ãƒ–'}];

async function init(){
  try{configData=await window.radialHub.config.getAll();document.getElementById('statusText').textContent='è¨­å®šèª­ã¿è¾¼ã¿å®Œäº†';document.getElementById('statusVersion').textContent='v'+(configData.version||'?');}
  catch(e){configData={tabs:[],hotkeys:{},clipboard:{},appearance:{},templates:[]};document.getElementById('statusText').textContent='èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼';}
  if(!configData.tabs||!configData.tabs.length)configData.tabs=[{id:'tab-default',name:'å…±é€š',icon:'âš™ï¸',items:Array(8).fill(null).map(()=>({icon:'â•',label:'æœªè¨­å®š',type:'launch',target:''})),registered:[]}];
  configData.tabs.forEach(t=>{if(!t.registered)t.registered=[];});
  if(!configData.templates)configData.templates=[];
  renderAll();buildEmojiGrid();
}
function renderAll(){renderTabList();renderEditView();renderPreview();renderPalette();}

async function saveConfig(){try{await window.radialHub.config.set('tabs',configData.tabs);await window.radialHub.config.set('templates',configData.templates);document.getElementById('statusText').textContent='âœ… ä¿å­˜å®Œäº† '+new Date().toLocaleTimeString();}catch(e){document.getElementById('statusText').textContent='âŒ ä¿å­˜ã‚¨ãƒ©ãƒ¼';}}
async function saveHotkeys(){await window.radialHub.config.set('hotkeys',configData.hotkeys);window.radialHub.hotkeys.reload();document.getElementById('statusText').textContent='âœ… ãƒ›ãƒƒãƒˆã‚­ãƒ¼ä¿å­˜å®Œäº†';}
async function exportConfig(){const r=await window.radialHub.config.export();if(r)showToast('ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†');}
async function importConfig(){const r=await window.radialHub.config.import();if(r){configData=await window.radialHub.config.getAll();configData.tabs.forEach(t=>{if(!t.registered)t.registered=[];});if(!configData.templates)configData.templates=[];currentTabIndex=0;editingSectorIndex=-1;renderAll();showToast('ğŸ“¥ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†');}}

function renderTabList(){const list=document.getElementById('tabList');list.innerHTML='';configData.tabs.forEach((tab,i)=>{const div=document.createElement('div');div.className='tab-item'+(i===currentTabIndex?' active':'');div.innerHTML='<span class="tab-item-icon">'+tab.icon+'</span><span class="tab-item-name">'+tab.name+'</span><span class="tab-item-key">'+(i+1)+'</span><div class="tab-move-btns"><div class="tab-move-btn" onclick="event.stopPropagation();moveTab('+i+','+(i-1)+')">â–²</div><div class="tab-move-btn" onclick="event.stopPropagation();moveTab('+i+','+(i+1)+')">â–¼</div></div>';div.onclick=()=>{currentTabIndex=i;editingSectorIndex=-1;showView('tab');};list.appendChild(div);});document.querySelectorAll('#navHotkey,#navClipboard,#navAppearance').forEach(el=>el.classList.remove('active'));}
function moveTab(from,to){if(to<0||to>=configData.tabs.length)return;const t=configData.tabs.splice(from,1)[0];configData.tabs.splice(to,0,t);currentTabIndex=to;renderAll();saveConfig();}
function showView(view){['tabEditView','hotkeyView','clipboardView','appearanceView'].forEach(v=>document.getElementById(v).style.display='none');document.getElementById('palettePanel').style.display='';document.getElementById('previewFloat').style.display='';if(view==='tab'){document.getElementById('tabEditView').style.display='';renderTabList();renderEditView();renderPreview();renderPalette();}else{document.getElementById(view+'View').style.display='';document.getElementById('palettePanel').style.display='none';document.getElementById('previewFloat').style.display='none';document.querySelectorAll('.tab-item').forEach(el=>el.classList.remove('active'));const n=document.getElementById('nav'+view.charAt(0).toUpperCase()+view.slice(1));if(n)n.classList.add('active');if(view==='hotkey')renderHotkeyView();if(view==='clipboard')renderClipboardView();if(view==='appearance')renderAppearanceView();}}
function renderEditView(){const tab=configData.tabs[currentTabIndex];if(!tab)return;document.getElementById('editTabIcon').textContent=tab.icon;document.getElementById('editTabName').value=tab.name;renderSectorGrid();}

function renderSectorGrid(){const area=document.getElementById('sectorGridArea'),tab=configData.tabs[currentTabIndex];if(!tab)return;let html='<div class="sector-grid">';for(let i=0;i<8;i++){const item=tab.items[i],isEd=editingSectorIndex===i;if(item&&item.label!=='æœªè¨­å®š'){const tc=item.type==='clipboard'?'type-clipboard':item.type==='templates'?'type-templates':item.type==='text'?'type-text':item.type==='screenshot_clip'||item.type==='screenshot_save'?'type-screenshot':'type-launch';const tl=item.type==='clipboard'?'ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰':item.type==='templates'?'å®šå‹æ–‡ä¸€è¦§':item.type==='text'?'å®šå‹æ–‡':item.type==='screenshot_clip'?'ğŸ“·â†’CLP':item.type==='screenshot_save'?'ğŸ“·â†’ä¿å­˜':'ã‚¢ãƒ—ãƒª/ãƒ•ã‚¡ã‚¤ãƒ«';html+='<div class="sector-card '+(isEd?'editing':'')+'" data-index="'+i+'" onclick="selectSector('+i+')"><div class="sector-card-num">#'+(i+1)+'</div><div class="sector-card-pos">'+posNames[i]+'</div><div class="sector-card-icon">'+iconHtml(item.iconData||item.icon,32)+'</div><div class="sector-card-label">'+item.label+'</div><div class="sector-card-type-wrap"><span class="sector-card-type '+tc+'">'+tl+'</span></div><div class="sector-swap-btns"><div class="sector-swap-btn" onclick="event.stopPropagation();swapSector('+i+','+(i-1)+')">â—€</div><div class="sector-swap-btn" onclick="event.stopPropagation();swapSector('+i+','+(i+1)+')">â–¶</div></div></div>';}else{html+='<div class="sector-card empty" data-index="'+i+'" onclick="selectSector('+i+')"><div class="sector-card-num">#'+(i+1)+'</div><div class="sector-card-pos">'+posNames[i]+'</div><div class="empty-icon">ï¼‹</div><div class="empty-text">ãƒ‰ãƒ­ãƒƒãƒ— or ã‚¯ãƒªãƒƒã‚¯</div></div>';}}html+='</div>';
if(editingSectorIndex>=0){const item=tab.items[editingSectorIndex]||{icon:'â­',label:'',type:'launch',target:''};if(!tab.items[editingSectorIndex])tab.items[editingSectorIndex]=item;const isText=item.type==='text',isSS=item.type==='screenshot_clip'||item.type==='screenshot_save';html+='<div class="edit-panel"><div class="edit-panel-title">âœï¸ #'+(editingSectorIndex+1)+'ï¼ˆ'+posNames[editingSectorIndex]+'ï¼‰</div><div class="form-grid"><div class="form-group"><div class="form-label">ã‚¢ã‚¤ã‚³ãƒ³</div><div style="display:flex;align-items:center;gap:8px"><div style="width:36px;height:36px;border-radius:8px;background:#f0f2f8;border:1px solid #ddd;display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer" onclick="openEmojiPicker('+editingSectorIndex+')">'+iconHtml(item.iconData||item.icon,28)+'</div><span style="font-size:10px;color:#aaa;cursor:pointer" onclick="openEmojiPicker('+editingSectorIndex+')">å¤‰æ›´</span>'+(item.iconData?'<span style="font-size:9px;color:#e44;cursor:pointer;margin-left:4px" onclick="resetSectorIcon()">âœ•ãƒªã‚»ãƒƒãƒˆ</span>':'')+'</div></div><div class="form-group"><div class="form-label">è¡¨ç¤ºå</div><input class="form-input" value="'+item.label+'" onchange="updateSector(\'label\',this.value)"></div><div class="form-group"><div class="form-label">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®é¡</div><select class="form-select" onchange="updateSector(\'type\',this.value);renderSectorGrid();"><option value="launch" '+(item.type==='launch'?'selected':'')+'>ğŸš€ ã‚¢ãƒ—ãƒª / ãƒ•ã‚¡ã‚¤ãƒ« / URL</option><option value="text" '+(item.type==='text'?'selected':'')+'>ğŸ“ å®šå‹æ–‡ï¼ˆç›´æ¥è²¼ã‚Šä»˜ã‘ï¼‰</option><option value="clipboard" '+(item.type==='clipboard'?'selected':'')+'>ğŸ“‹ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰å±¥æ­´</option><option value="templates" '+(item.type==='templates'?'selected':'')+'>ğŸ“‘ å®šå‹æ–‡ä¸€è¦§</option><option value="screenshot_clip" '+(item.type==='screenshot_clip'?'selected':'')+'>ğŸ“· ç¯„å›²ã‚­ãƒ£ãƒ—ãƒãƒ£ â†’ CLP</option><option value="screenshot_save" '+(item.type==='screenshot_save'?'selected':'')+'>ğŸ’¾ ç¯„å›²ã‚­ãƒ£ãƒ—ãƒãƒ£ â†’ ä¿å­˜</option></select></div><div class="form-group"><div class="form-label">'+(isText?'ãƒ†ã‚­ã‚¹ãƒˆå†…å®¹':isSS?(item.type==='screenshot_save'?'ä¿å­˜å…ˆãƒ•ã‚©ãƒ«ãƒ€':'è¨­å®šä¸è¦'):'ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼ˆãƒ‘ã‚¹/URLï¼‰')+'</div>'+(isText?'<textarea class="form-textarea" onchange="updateSector(\'target\',this.value)">'+(item.target||'')+'</textarea>':isSS&&item.type==='screenshot_save'?'<input class="form-input" value="'+(item.target||'')+'" onchange="updateSector(\'target\',this.value)" placeholder="D:\\Screenshots\\">':isSS?'<div style="font-size:11px;color:#999;padding:8px">ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼</div>':'<input class="form-input" value="'+(item.target||'')+'" onchange="updateSector(\'target\',this.value)" placeholder="C:\\... or https://..." '+(item.type!=='launch'?'disabled style="opacity:.4"':'')+'>')+'</div></div><div class="panel-actions"><button class="btn btn-danger" onclick="clearSector('+editingSectorIndex+')">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button><button class="btn btn-secondary" onclick="editingSectorIndex=-1;renderSectorGrid();">é–‰ã˜ã‚‹</button><button class="btn btn-primary" onclick="saveSector()">ğŸ’¾ ä¿å­˜</button></div></div>';}area.innerHTML=html;
// ã‚»ã‚¯ã‚¿ãƒ¼ã‚«ãƒ¼ãƒ‰ã«ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³è¨­å®š
document.querySelectorAll('.sector-card').forEach(card=>{card.addEventListener('dragover',e=>{e.preventDefault();e.stopPropagation();card.classList.add('drag-over');});card.addEventListener('dragleave',()=>card.classList.remove('drag-over'));card.addEventListener('drop',async e=>{e.preventDefault();e.stopPropagation();card.classList.remove('drag-over');const files=e.dataTransfer.files;if(files.length>0){const idx=parseInt(card.dataset.index);if(isNaN(idx))return;const f=files[0],fpath=f.path||f.name;try{const r=await window.radialHub.file.resolveDrop(fpath);configData.tabs[currentTabIndex].items[idx]={icon:'ğŸ“',iconData:r.iconData||'',label:r.name||f.name.replace(/\.[^.]+$/,''),type:'launch',target:r.target||fpath};}catch(err){configData.tabs[currentTabIndex].items[idx]={icon:'ğŸ“',label:f.name.replace(/\.[^.]+$/,''),type:'launch',target:fpath};}editingSectorIndex=idx;renderSectorGrid();renderPreview();saveConfig();showToast('âœ… #'+(idx+1)+'ã«é…ç½®');}});});}

function selectSector(i){editingSectorIndex=(editingSectorIndex===i)?-1:i;renderSectorGrid();renderPreview();}
function updateSector(k,v){if(editingSectorIndex>=0)configData.tabs[currentTabIndex].items[editingSectorIndex][k]=v;}
function clearSector(i){configData.tabs[currentTabIndex].items[i]={icon:'â•',label:'æœªè¨­å®š',type:'launch',target:''};editingSectorIndex=-1;renderSectorGrid();renderPreview();saveConfig();showToast('ğŸ—‘ï¸ ã‚¯ãƒªã‚¢');}
function saveSector(){editingSectorIndex=-1;renderSectorGrid();renderPreview();saveConfig();showToast('âœ… ä¿å­˜ã—ã¾ã—ãŸ');}

function renderHotkeyView(){const c=document.getElementById('hotkeyContent'),hk=configData.hotkeys||{};c.innerHTML=hotkeyDefs.map(d=>'<div class="hotkey-row"><span class="hotkey-label">'+d.label+'</span><div class="hotkey-input" data-key="'+d.key+'" onclick="recordHotkey(this)">'+(hk[d.key]||'æœªè¨­å®š')+'</div></div>').join('');}
function recordHotkey(el){el.classList.add('recording');el.textContent='ã‚­ãƒ¼ã‚’å…¥åŠ›...';const h=e=>{e.preventDefault();const p=[];if(e.ctrlKey)p.push('Ctrl');if(e.shiftKey)p.push('Shift');if(e.altKey)p.push('Alt');if(e.key&&!['Control','Shift','Alt'].includes(e.key))p.push(e.key===' '?'Space':e.key.length===1?e.key.toUpperCase():e.key);if(p.length>1||(!e.ctrlKey&&!e.shiftKey&&!e.altKey&&p.length===1)){const combo=p.join('+');el.textContent=combo;el.classList.remove('recording');configData.hotkeys[el.dataset.key]=combo;saveHotkeys();document.removeEventListener('keydown',h);}};document.addEventListener('keydown',h);}

function renderClipboardView(){const c=document.getElementById('clipboardContent'),cl=configData.clipboard||{};c.innerHTML='<div class="setting-row"><div class="setting-label-group"><span class="setting-label">ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ç›£è¦–</span><span class="setting-desc">ã‚³ãƒ”ãƒ¼å†…å®¹ã‚’è‡ªå‹•ä¿å­˜</span></div><div class="toggle '+(cl.enabled!==false?'on':'')+'" onclick="toggleClipSetting(this,\'enabled\')"><div class="toggle-knob"></div></div></div><div class="setting-row"><div class="setting-label-group"><span class="setting-label">æœ€å¤§ä¿å­˜ä»¶æ•°</span></div><input class="setting-number" type="number" value="'+(cl.maxHistory||100)+'" min="10" max="1000" onchange="configData.clipboard.maxHistory=parseInt(this.value);saveClipSettings()"></div><div class="setting-row"><div class="setting-label-group"><span class="setting-label">ç”»åƒã‚‚ä¿å­˜</span></div><div class="toggle '+(cl.saveImages!==false?'on':'')+'" onclick="toggleClipSetting(this,\'saveImages\')"><div class="toggle-knob"></div></div></div><div class="setting-row"><div class="setting-label-group"><span class="setting-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰é™¤å¤–</span></div><div class="toggle '+(cl.excludePasswords!==false?'on':'')+'" onclick="toggleClipSetting(this,\'excludePasswords\')"><div class="toggle-knob"></div></div></div>';}
function toggleClipSetting(el,key){el.classList.toggle('on');if(!configData.clipboard)configData.clipboard={};configData.clipboard[key]=el.classList.contains('on');saveClipSettings();}
async function saveClipSettings(){await window.radialHub.config.set('clipboard',configData.clipboard);document.getElementById('statusText').textContent='âœ… ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰è¨­å®šä¿å­˜';}

async function renderAppearanceView(){
  const c=document.getElementById('appearanceContent'),ap=configData.appearance||{};
  let autoStart=true;try{autoStart=await window.radialHub.autoLaunch.get();}catch(e){}
  c.innerHTML='<div style="font-size:11px;color:#4a6cf7;font-weight:600;margin-bottom:8px">ğŸš€ èµ·å‹•</div><div class="setting-row"><div class="setting-label-group"><span class="setting-label">PCèµ·å‹•æ™‚ã«è‡ªå‹•èµ·å‹•</span><span class="setting-desc">ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã«ç™»éŒ²</span></div><div class="toggle '+(autoStart?'on':'')+'" onclick="toggleAutoStart(this)"><div class="toggle-knob"></div></div></div><div style="font-size:11px;color:#4a6cf7;font-weight:600;margin:16px 0 8px">ğŸ¨ å¤–è¦³</div><div class="setting-row"><div class="setting-label-group"><span class="setting-label">ãƒ†ãƒ¼ãƒ</span><span class="setting-desc">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®é…è‰²ã‚’åˆ‡æ›¿</span></div><select class="setting-select" onchange="configData.appearance.theme=this.value;saveAppSettings()"><option value="dark" '+(ap.theme!=='light'?'selected':'')+'>ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</option><option value="light" '+(ap.theme==='light'?'selected':'')+'>ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰</option></select></div><div class="setting-row"><div class="setting-label-group"><span class="setting-label">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚µã‚¤ã‚º (px)</span></div><input class="setting-number" type="number" value="'+(ap.menuSize||380)+'" step="20" onchange="configData.appearance.menuSize=parseInt(this.value);saveAppSettings()"></div><div class="setting-row"><div class="setting-label-group"><span class="setting-label">é€éåº¦ %</span></div><input class="setting-number" type="number" value="'+(ap.opacity||95)+'" min="50" max="100" onchange="configData.appearance.opacity=parseInt(this.value);saveAppSettings()"></div><div class="setting-row"><div class="setting-label-group"><span class="setting-label">ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</span></div><div class="toggle '+(ap.animation!==false?'on':'')+'" onclick="toggleAppSetting(this,\'animation\')"><div class="toggle-knob"></div></div></div>';
}
async function toggleAutoStart(el){el.classList.toggle('on');const enabled=el.classList.contains('on');await window.radialHub.autoLaunch.set(enabled);document.getElementById('statusText').textContent=enabled?'âœ… ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—æœ‰åŠ¹':'âš« ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ç„¡åŠ¹';}
function toggleAppSetting(el,key){el.classList.toggle('on');if(!configData.appearance)configData.appearance={};configData.appearance[key]=el.classList.contains('on');saveAppSettings();}
async function saveAppSettings(){await window.radialHub.config.set('appearance',configData.appearance);document.getElementById('statusText').textContent='âœ… å¤–è¦³è¨­å®šä¿å­˜';}

function switchPaletteTab(el){document.querySelectorAll('.palette-tab').forEach(t=>t.classList.remove('active'));el.classList.add('active');currentPaletteTab=el.dataset.pt;renderPalette();}
function renderPalette(){const c=document.getElementById('paletteContent');let html='';
if(currentPaletteTab==='templates'){html+='<div class="palette-section-title">å…±é€šå®šå‹æ–‡ <span class="palette-add-btn" onclick="toggleNewTemplate()">ï¼‹ è¿½åŠ </span></div>';html+='<div class="new-template-wrap" id="newTemplateWrap"><textarea class="new-template-input" id="newTemplateInput" placeholder="æ–°ã—ã„å®šå‹æ–‡ã‚’å…¥åŠ›..."></textarea><div class="new-template-actions"><button class="btn btn-secondary" onclick="toggleNewTemplate()" style="padding:3px 8px;font-size:10px">å–æ¶ˆ</button><button class="btn btn-primary" onclick="addTemplate()" style="padding:3px 8px;font-size:10px">è¿½åŠ </button></div></div>';(configData.templates||[]).forEach((tpl,i)=>{const short=tpl.length>24?tpl.substring(0,24)+'...':tpl;const obj=JSON.stringify({icon:'ğŸ“',label:short,type:'text',target:tpl}).replace(/"/g,'&quot;');html+='<div class="palette-item" onmousedown="startDrag(event,'+obj+')"><span class="palette-item-icon">ğŸ“</span><div class="palette-item-info"><div class="palette-item-name">'+short+'</div><div class="palette-item-desc">ãƒ‰ãƒ©ãƒƒã‚°ã§ã‚¹ãƒ­ãƒƒãƒˆã«é…ç½®</div></div><button onclick="event.stopPropagation();deleteTemplate('+i+')" style="background:none;border:none;color:#ccc;cursor:pointer;font-size:12px">âœ•</button></div>';});if(!(configData.templates||[]).length)html+='<div style="text-align:center;padding:16px;color:#bbb;font-size:11px">å®šå‹æ–‡ãŒã‚ã‚Šã¾ã›ã‚“</div>';}
else if(currentPaletteTab==='launch'){const ssClip=JSON.stringify({icon:'âœ‚ï¸',label:'ç¯„å›²ã‚­ãƒ£ãƒ—ãƒãƒ£â†’CLP',type:'screenshot_clip',target:''}).replace(/"/g,'&quot;');const ssSave=JSON.stringify({icon:'ğŸ’¾',label:'ç¯„å›²ã‚­ãƒ£ãƒ—ãƒãƒ£â†’ä¿å­˜',type:'screenshot_save',target:'D:\\Screenshots\\'}).replace(/"/g,'&quot;');html+='<div class="palette-section-title">ğŸ“· ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ</div>';html+='<div class="screenshot-card" onmousedown="startDrag(event,'+ssClip+')"><div class="screenshot-card-icon">âœ‚ï¸</div><div class="screenshot-card-info"><div class="screenshot-card-name">ç¯„å›²ã‚­ãƒ£ãƒ—ãƒãƒ£ â†’ CLP</div><div class="screenshot-card-desc">Ctrl+Vã§è²¼ã‚Šä»˜ã‘</div></div><span class="screenshot-card-badge">CLP</span></div>';html+='<div class="screenshot-card" onmousedown="startDrag(event,'+ssSave+')"><div class="screenshot-card-icon">ğŸ’¾</div><div class="screenshot-card-info"><div class="screenshot-card-name">ç¯„å›²ã‚­ãƒ£ãƒ—ãƒãƒ£ â†’ ä¿å­˜</div><div class="screenshot-card-desc">æŒ‡å®šãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜</div></div><span class="screenshot-card-badge">FILE</span></div>';const tab=configData.tabs[currentTabIndex];html+='<div class="palette-section-title" style="margin-top:8px">ç™»éŒ²æ¸ˆã¿ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ <span class="palette-add-btn" onclick="openBrowseModal()">ï¼‹ ç™»éŒ²</span></div>';html+='<div class="drop-zone" id="paletteDropZone"><div class="drop-zone-icon">ğŸ“‚</div><div class="drop-zone-main">ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ / ãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒ‰ãƒ­ãƒƒãƒ—</div></div>';html+='<div class="dialog-btns"><div class="dialog-btn" onclick="dialogSelectFile(\'palette\')">ğŸ“„ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</div><div class="dialog-btn" onclick="dialogSelectFolder(\'palette\')">ğŸ“‚ ãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠ</div></div>';(tab.registered||[]).forEach((reg,i)=>{html+='<div class="registered-item" onmousedown="startDragRegistered(event,'+i+')"><span class="registered-item-icon">'+iconHtml(reg.iconData||reg.icon,20)+'</span><div class="registered-item-info"><div class="registered-item-name">'+reg.label+'</div><div class="registered-item-path">'+reg.path+'</div></div><button class="registered-item-del" onclick="event.stopPropagation();deleteRegistered('+i+')">âœ•</button></div>';});}
else if(currentPaletteTab==='system'){html+='<div class="palette-section-title">ã‚·ã‚¹ãƒ†ãƒ æ©Ÿèƒ½</div>';systemItems.forEach(item=>{const obj=JSON.stringify(item).replace(/"/g,'&quot;');const tc=item.type==='clipboard'?'type-clipboard':item.type==='templates'?'type-templates':'type-launch';const tl=item.type==='clipboard'?'CLP':item.type==='templates'?'ä¸€è¦§':'SYS';html+='<div class="palette-item" onmousedown="startDrag(event,'+obj+')"><span class="palette-item-icon">'+item.icon+'</span><div class="palette-item-info"><div class="palette-item-name">'+item.label+'</div><div class="palette-item-desc">'+(item.target||'çµ„ã¿è¾¼ã¿æ©Ÿèƒ½')+'</div></div><span class="palette-item-badge '+tc+'">'+tl+'</span></div>';});}
c.innerHTML=html;setTimeout(setupDropZones,0);}

function setupDropZones(){['paletteDropZone','modalDropZone'].forEach(id=>{const dz=document.getElementById(id);if(!dz)return;dz.addEventListener('dragover',e=>{e.preventDefault();e.stopPropagation();dz.classList.add('drag-active');});dz.addEventListener('dragleave',()=>dz.classList.remove('drag-active'));dz.addEventListener('drop',async e=>{e.preventDefault();e.stopPropagation();dz.classList.remove('drag-active');const files=e.dataTransfer.files;if(files.length>0){const f=files[0],fpath=f.path||f.name;if(id==='modalDropZone'){document.getElementById('browsePathInput').value=fpath;document.getElementById('browseNameInput').value=f.name.replace(/\.[^.]+$/,'');}else{try{const r=await window.radialHub.file.resolveDrop(fpath);registerShortcut('ğŸ“',r.name||f.name.replace(/\.[^.]+$/,''),r.target||fpath,r.iconData);}catch(e){registerShortcut('ğŸ“',f.name.replace(/\.[^.]+$/,''),fpath);}}}});});}

// ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ•ã‚©ãƒ«ãƒ€é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°
async function dialogSelectFile(mode){
  const r=await window.radialHub.dialog.openFile();
  if(!r)return;
  if(mode==='modal'){document.getElementById('browsePathInput').value=r.target;document.getElementById('browseNameInput').value=r.name;}
  else{registerShortcut('ğŸ“',r.name,r.target,r.iconData);}
}
async function dialogSelectFolder(mode){
  const r=await window.radialHub.dialog.openFolder();
  if(!r)return;
  if(mode==='modal'){document.getElementById('browsePathInput').value=r.target;document.getElementById('browseNameInput').value=r.name;}
  else{registerShortcut('ğŸ“‚',r.name,r.target,r.iconData);}
}

function toggleNewTemplate(){const w=document.getElementById('newTemplateWrap');if(w)w.classList.toggle('visible');}
function addTemplate(){const inp=document.getElementById('newTemplateInput');if(!inp||!inp.value.trim())return;if(!configData.templates)configData.templates=[];configData.templates.push(inp.value.trim());inp.value='';toggleNewTemplate();renderPalette();saveConfig();showToast('ğŸ“ è¿½åŠ ');}
function deleteTemplate(i){configData.templates.splice(i,1);renderPalette();saveConfig();}
function registerShortcut(icon,label,path,iconData){if(!configData.tabs[currentTabIndex].registered)configData.tabs[currentTabIndex].registered=[];configData.tabs[currentTabIndex].registered.push({icon:icon,label,path,iconData:iconData||''});renderPalette();saveConfig();showToast('âœ… ã€Œ'+label+'ã€ã‚’ç™»éŒ²');}
function deleteRegistered(i){configData.tabs[currentTabIndex].registered.splice(i,1);renderPalette();saveConfig();}
function openBrowseModal(){browseIcon='ğŸ“';document.getElementById('browseIconPreview').textContent=browseIcon;document.getElementById('browsePathInput').value='';document.getElementById('browseNameInput').value='';document.getElementById('browseModal').classList.add('visible');setTimeout(setupDropZones,0);}
function closeBrowseModal(){document.getElementById('browseModal').classList.remove('visible');}
function registerFromBrowse(){const p=document.getElementById('browsePathInput').value.trim(),n=document.getElementById('browseNameInput').value.trim()||'æ–°ã—ã„ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ';if(!p){showToast('âš ï¸ ãƒ‘ã‚¹ã‚’å…¥åŠ›');return;}registerShortcut(browseIcon,n,p);closeBrowseModal();}
function onTabNameChange(){configData.tabs[currentTabIndex].name=document.getElementById('editTabName').value;renderTabList();saveConfig();}
function swapSector(a,b){const items=configData.tabs[currentTabIndex].items;if(b<0||b>=8)return;const tmp=items[a];items[a]=items[b];items[b]=tmp;editingSectorIndex=b;renderSectorGrid();renderPreview();saveConfig();}
function addNewTab(){configData.tabs.push({id:'tab'+Date.now(),name:'æ–°ã—ã„ã‚¿ãƒ–',icon:'ğŸ“Œ',items:Array(8).fill(null).map(()=>({icon:'â•',label:'æœªè¨­å®š',type:'launch',target:''})),registered:[]});currentTabIndex=configData.tabs.length-1;editingSectorIndex=-1;renderAll();saveConfig();showToast('â• ã‚¿ãƒ–è¿½åŠ ');}
function duplicateTab(){const c=JSON.parse(JSON.stringify(configData.tabs[currentTabIndex]));c.id='tab'+Date.now();c.name+=' (ã‚³ãƒ”ãƒ¼)';configData.tabs.splice(currentTabIndex+1,0,c);currentTabIndex++;renderAll();saveConfig();showToast('ğŸ“„ è¤‡è£½');}
function deleteTab(){if(configData.tabs.length<=1){showToast('âš ï¸ æœ€å¾Œã®ã‚¿ãƒ–');return;}configData.tabs.splice(currentTabIndex,1);if(currentTabIndex>=configData.tabs.length)currentTabIndex--;editingSectorIndex=-1;renderAll();saveConfig();showToast('ğŸ—‘ï¸ å‰Šé™¤');}
let dragData=null;const ghost=document.getElementById('dragGhost');
function startDragRegistered(e,regIdx){const tab=configData.tabs[currentTabIndex];const reg=tab.registered[regIdx];if(!reg)return;const data={icon:reg.icon||'ğŸ“',iconData:reg.iconData||'',label:reg.label,type:'launch',target:reg.path};startDrag(e,data);}
function startDrag(e,data){e.preventDefault();dragData=data;ghost.textContent=(data.icon&&data.icon.startsWith('data:')?'ğŸ“':data.icon)+' '+data.label;ghost.style.display='block';moveGhost(e);document.addEventListener('mousemove',moveGhost);document.addEventListener('mouseup',endDrag);const el=e.target.closest('.palette-item,.registered-item,.screenshot-card');if(el)el.classList.add('dragging');}
function moveGhost(e){ghost.style.left=(e.clientX+12)+'px';ghost.style.top=(e.clientY-10)+'px';}
function endDrag(e){ghost.style.display='none';document.removeEventListener('mousemove',moveGhost);document.removeEventListener('mouseup',endDrag);document.querySelectorAll('.dragging').forEach(el=>el.classList.remove('dragging'));document.querySelectorAll('.sector-card.drag-over').forEach(el=>el.classList.remove('drag-over'));const t=document.elementFromPoint(e.clientX,e.clientY),card=t?t.closest('.sector-card'):null;if(card&&dragData){const idx=parseInt(card.dataset.index);if(!isNaN(idx)){configData.tabs[currentTabIndex].items[idx]={...dragData};editingSectorIndex=idx;renderSectorGrid();renderPreview();saveConfig();showToast('âœ… #'+(idx+1)+'ï¼ˆ'+posNames[idx]+'ï¼‰ã«é…ç½®');}}dragData=null;}
document.addEventListener('mousemove',e=>{if(!dragData)return;document.querySelectorAll('.sector-card').forEach(card=>{const r=card.getBoundingClientRect();card.classList.toggle('drag-over',e.clientX>=r.left&&e.clientX<=r.right&&e.clientY>=r.top&&e.clientY<=r.bottom);});});
function buildEmojiGrid(){const g=document.getElementById('emojiGrid');emojis.forEach(e=>{const b=document.createElement('button');b.className='emoji-btn';b.textContent=e;b.onclick=()=>selectEmoji(e);g.appendChild(b);});}
function openEmojiPicker(t){emojiTarget=t;document.getElementById('emojiModal').classList.add('visible');}
function closeEmojiPicker(){document.getElementById('emojiModal').classList.remove('visible');}
function resetSectorIcon(){if(typeof editingSectorIndex==='number'&&editingSectorIndex>=0){configData.tabs[currentTabIndex].items[editingSectorIndex].iconData='';renderSectorGrid();renderPreview();saveConfig();showToast('ğŸ”„ ã‚¢ã‚¤ã‚³ãƒ³ãƒªã‚»ãƒƒãƒˆ');}}
function selectEmoji(emoji){if(emojiTarget==='tab')configData.tabs[currentTabIndex].icon=emoji;else if(emojiTarget==='browse'){browseIcon=emoji;document.getElementById('browseIconPreview').textContent=emoji;}else if(typeof emojiTarget==='number'){configData.tabs[currentTabIndex].items[emojiTarget].icon=emoji;configData.tabs[currentTabIndex].items[emojiTarget].iconData='';}closeEmojiPicker();renderAll();saveConfig();}
function renderPreview(){const svg=document.getElementById('previewSvg');svg.innerHTML='';const cx=55,cy=55,inner=16,outer=50,tab=configData.tabs[currentTabIndex];if(!tab)return;tab.items.forEach((item,i)=>{const sa=(i*45-90-22.5)*Math.PI/180,ea=((i+1)*45-90-22.5)*Math.PI/180,ma=(sa+ea)/2;const d='M '+(cx+inner*Math.cos(sa))+' '+(cy+inner*Math.sin(sa))+' L '+(cx+outer*Math.cos(sa))+' '+(cy+outer*Math.sin(sa))+' A '+outer+' '+outer+' 0 0 1 '+(cx+outer*Math.cos(ea))+' '+(cy+outer*Math.sin(ea))+' L '+(cx+inner*Math.cos(ea))+' '+(cy+inner*Math.sin(ea))+' A '+inner+' '+inner+' 0 0 0 '+(cx+inner*Math.cos(sa))+' '+(cy+inner*Math.sin(sa))+' Z';const p=document.createElementNS('http://www.w3.org/2000/svg','path');p.setAttribute('d',d);p.setAttribute('class','preview-sector'+(i===editingSectorIndex?' highlight':''));svg.appendChild(p);const t=document.createElementNS('http://www.w3.org/2000/svg','text');t.setAttribute('x',cx+35*Math.cos(ma));t.setAttribute('y',cy+35*Math.sin(ma));t.setAttribute('text-anchor','middle');t.setAttribute('dominant-baseline','central');t.setAttribute('font-size','11');t.textContent=item.icon;svg.appendChild(t);});}
function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1800);}
init();
</script>
</body>
</html>
