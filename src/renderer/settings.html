<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ring-Link - è¨­å®š</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box;-webkit-user-select:none;user-select:none}
  input,textarea,select{-webkit-user-select:text;user-select:text}
  body{background:#f4f5f7;font-family:'Segoe UI','Yu Gothic UI',sans-serif;color:#1a1a2e;min-height:100vh}
  .header{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:#fff;border-bottom:1px solid #e0e2e8;box-shadow:0 1px 3px rgba(0,0,0,0.04)}
  .header-title{display:flex;align-items:center;gap:10px;font-size:15px;font-weight:600;color:#4a6cf7}
  .header-right{display:flex;gap:8px}
  .header-btn{background:#f0f1f4;border:1px solid #dcdee4;color:#555;padding:5px 12px;border-radius:6px;cursor:pointer;font-size:12px;display:flex;align-items:center;gap:4px;transition:all .15s}
  .header-btn:hover{background:#e4e6ec;color:#333}
  .header-btn.primary{background:#4a6cf7;border-color:#3b5de7;color:#fff}
  .header-btn.primary:hover{background:#3b5de7}
  .layout{display:flex;height:calc(100vh - 49px)}
  .sidebar{width:200px;background:#fff;border-right:1px solid #e0e2e8;padding:12px 0;display:flex;flex-direction:column;flex-shrink:0}
  .sidebar-title{font-size:9px;color:#999;text-transform:uppercase;letter-spacing:1.5px;padding:0 14px;margin-bottom:8px}
  .tab-list{flex:1;overflow-y:auto}
  .tab-item{display:flex;align-items:center;gap:8px;padding:8px 14px;cursor:pointer;transition:all .15s;border-left:3px solid transparent}
  .tab-item:hover{background:#f0f2f8}
  .tab-item.active{background:#eef1ff;border-left-color:#4a6cf7}
  .tab-item-icon{font-size:16px}
  .tab-item-name{flex:1;font-size:12px;color:#555}
  .tab-item.active .tab-item-name{color:#4a6cf7;font-weight:500}
  .tab-item-key{font-size:9px;color:#aaa;background:#f0f1f4;border:1px solid #e0e2e8;border-radius:3px;padding:1px 4px}
  .tab-item.active .tab-item-key{color:#4a6cf7;background:#e0e6ff;border-color:#c0ccff}
  .tab-move-btns{display:flex;flex-direction:column;gap:1px;margin-left:auto;flex-shrink:0}
  .tab-move-btn{width:18px;height:14px;border:1px solid #ddd;border-radius:3px;background:#f8f9fb;cursor:pointer;font-size:8px;display:flex;align-items:center;justify-content:center;color:#999;line-height:1}
  .tab-move-btn:hover{background:#e0e6ff;color:#4a6cf7;border-color:#b0c0ff}
  .tab-add-btn{margin:6px 12px;padding:7px;border:1px dashed #ccc;border-radius:6px;text-align:center;font-size:11px;color:#999;cursor:pointer}
  .tab-add-btn:hover{border-color:#4a6cf7;color:#4a6cf7;background:#f8f9ff}
  .sidebar-nav{border-top:1px solid #e0e2e8;margin-top:auto;padding-top:8px}
  .main{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0}
  .edit-header{padding:14px 20px 0;display:flex;align-items:center;gap:14px;flex-shrink:0}
  .edit-tab-icon{width:42px;height:42px;border-radius:10px;background:#eef1ff;border:1px solid #d0d8ff;display:flex;align-items:center;justify-content:center;font-size:22px;cursor:pointer}
  .edit-tab-icon:hover{background:#e0e6ff}
  .edit-tab-name-input{background:transparent;border:none;border-bottom:2px solid #e0e2e8;color:#1a1a2e;font-size:18px;font-weight:600;padding:2px 0;width:240px;outline:none}
  .edit-tab-name-input:focus{border-bottom-color:#4a6cf7}
  .edit-tab-desc{font-size:10px;color:#999;margin-top:2px}
  .edit-tab-actions{display:flex;gap:6px;margin-left:auto}
  .btn{padding:5px 10px;border-radius:5px;font-size:11px;cursor:pointer;transition:all .15s;border:1px solid;display:flex;align-items:center;gap:4px}
  .btn-danger{background:#fff0f0;border-color:#fcc;color:#e44}
  .btn-danger:hover{background:#ffe0e0}
  .btn-secondary{background:#f0f1f4;border-color:#dcdee4;color:#666}
  .btn-secondary:hover{background:#e4e6ec;color:#333}
  .btn-primary{background:#4a6cf7;border-color:#3b5de7;color:#fff}
  .btn-primary:hover{background:#3b5de7}
  .edit-content{flex:1;overflow-y:auto;padding:14px 20px}
  .content-label{font-size:10px;color:#999;text-transform:uppercase;letter-spacing:1px;margin-bottom:10px}
  .sector-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  .sector-card{background:#fff;border:2px solid #e0e2e8;border-radius:10px;padding:12px 8px;cursor:pointer;position:relative;transition:all .15s;position:relative;min-height:110px;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 1px 3px rgba(0,0,0,0.04)}
  .sector-card:hover{border-color:#b0bcff;box-shadow:0 2px 8px rgba(74,108,247,0.1)}
  .sector-card.editing{border-color:#4a6cf7;background:#f8f9ff;box-shadow:0 2px 12px rgba(74,108,247,0.15)}
  .sector-card.drag-over{border-color:#4caf50;background:#f0faf0;border-style:dashed;transform:scale(1.03)}
  .sector-card-num{position:absolute;top:6px;left:8px;font-size:9px;color:#bbb;font-weight:700}
  .sector-card-pos{position:absolute;top:6px;right:8px;font-size:9px;color:#bbb}
  .sector-card-icon{font-size:28px;margin:4px 0}
  .sector-card-icon img{width:32px;height:32px;object-fit:contain}
  .sector-card-label{font-size:11px;color:#555;margin-bottom:4px;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:100%}
  .sector-card-type-wrap{text-align:center}
  .sector-swap-btns{position:absolute;top:2px;right:2px;display:flex;gap:1px}
  .sector-swap-btn{width:18px;height:16px;border:1px solid #ddd;border-radius:3px;background:#f8f9fb;cursor:pointer;font-size:8px;display:flex;align-items:center;justify-content:center;color:#999}
  .sector-swap-btn:hover{background:#e0e6ff;color:#4a6cf7;border-color:#b0c0ff}
  .sector-card-type{font-size:9px;padding:1px 6px;border-radius:3px;display:inline-block}
  .type-launch{background:#e8f5e9;color:#2e7d32}.type-clipboard{background:#fff3e0;color:#e65100}.type-templates{background:#f3e5f5;color:#7b1fa2}.type-text{background:#e3f2fd;color:#1565c0}.type-screenshot{background:#fce4ec;color:#c62828}
  .sector-card.empty{border-style:dashed;border-color:#ddd;background:#fafafa;box-shadow:none}
  .sector-card.empty:hover{border-color:#4a6cf7;background:#f8f9ff}
  .empty-icon{font-size:20px;color:#ccc}.empty-text{font-size:10px;color:#bbb;margin-top:2px}
  .edit-panel{margin-top:12px;background:#fff;border:1px solid #d0d8ff;border-radius:10px;padding:16px;box-shadow:0 2px 8px rgba(74,108,247,0.08)}
  .edit-panel-title{font-size:13px;font-weight:600;color:#4a6cf7;margin-bottom:12px}
  .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .form-group{display:flex;flex-direction:column;gap:4px}
  .form-label{font-size:10px;color:#888;text-transform:uppercase;letter-spacing:.5px}
  .form-input{background:#f8f9fc;border:1px solid #dcdee4;border-radius:5px;color:#333;padding:6px 10px;font-size:12px;outline:none}
  .form-input:focus{border-color:#4a6cf7;background:#fff}
  .form-select{background:#f8f9fc;border:1px solid #dcdee4;border-radius:5px;color:#333;padding:6px 10px;font-size:12px;outline:none;cursor:pointer}
  .form-textarea{background:#f8f9fc;border:1px solid #dcdee4;border-radius:5px;color:#333;padding:6px 10px;font-size:12px;outline:none;resize:vertical;min-height:60px;font-family:inherit}
  .form-textarea:focus{border-color:#4a6cf7;background:#fff}
  .panel-actions{display:flex;justify-content:flex-end;gap:6px;margin-top:12px;padding-top:10px;border-top:1px solid #eee}
  .palette{width:270px;background:#fff;border-left:1px solid #e0e2e8;display:flex;flex-direction:column;flex-shrink:0;overflow:hidden}
  .palette-header{padding:12px 14px;font-size:12px;font-weight:600;color:#4a6cf7;border-bottom:1px solid #e0e2e8}
  .palette-tabs{display:flex;border-bottom:1px solid #e0e2e8}
  .palette-tab{flex:1;padding:7px 0;text-align:center;font-size:11px;color:#999;cursor:pointer;border-bottom:2px solid transparent;transition:all .15s}
  .palette-tab:hover{color:#555}
  .palette-tab.active{color:#4a6cf7;border-bottom-color:#4a6cf7}
  .palette-content{flex:1;overflow-y:auto;padding:8px}
  .palette-item{display:flex;align-items:center;gap:8px;padding:8px 10px;margin-bottom:4px;background:#f8f9fc;border:1px solid #e8eaef;border-radius:7px;cursor:grab;transition:all .15s}
  .palette-item:hover{background:#eef1ff;border-color:#c0ccff}
  .palette-item.dragging{opacity:.4}
  .palette-item-icon{font-size:18px;flex-shrink:0}
  .palette-item-info{flex:1;min-width:0}
  .palette-item-name{font-size:11px;color:#444;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .palette-item-desc{font-size:9px;color:#aaa;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:1px}
  .palette-item-badge{font-size:8px;padding:1px 5px;border-radius:3px;flex-shrink:0}
  .palette-section-title{font-size:9px;color:#999;text-transform:uppercase;letter-spacing:1px;padding:8px 4px 4px;display:flex;align-items:center;justify-content:space-between}
  .palette-add-btn{font-size:9px;color:#4a6cf7;cursor:pointer;padding:2px 6px;border-radius:3px}
  .palette-add-btn:hover{background:#eef1ff}
  .screenshot-card{display:flex;align-items:center;gap:10px;padding:10px 12px;margin-bottom:6px;background:#fef5f7;border:1px solid #f8d0d8;border-radius:8px;cursor:grab;transition:all .15s}
  .screenshot-card:hover{background:#fdeaef;border-color:#f0a0b0}
  .screenshot-card-icon{font-size:22px}.screenshot-card-info{flex:1}.screenshot-card-name{font-size:12px;color:#c62828;font-weight:500}.screenshot-card-desc{font-size:9px;color:#b77;margin-top:1px}
  .screenshot-card-badge{font-size:8px;padding:2px 6px;border-radius:3px;background:#fce4ec;color:#c62828}
  .drop-zone{margin:4px 0 8px;padding:16px 10px;border:2px dashed #ccc;border-radius:8px;text-align:center;transition:all .2s;cursor:pointer}
  .drop-zone:hover,.drop-zone.drag-active{border-color:#4caf50;background:#f0faf0}
  .drop-zone-icon{font-size:28px;margin-bottom:4px}.drop-zone-main{font-size:11px;color:#777;margin-bottom:2px}.drop-zone-sub{font-size:9px;color:#aaa;line-height:1.5}
  .dialog-btns{display:flex;gap:4px;margin:4px 0 8px}
  .dialog-btn{flex:1;padding:8px;border:1px solid #dcdee4;border-radius:7px;background:#f8f9fc;cursor:pointer;text-align:center;font-size:11px;color:#555;transition:all .15s}
  .dialog-btn:hover{background:#eef1ff;border-color:#4a6cf7;color:#4a6cf7}
  .registered-item{display:flex;align-items:center;gap:8px;padding:7px 10px;margin-bottom:4px;background:#f8f9fc;border:1px solid #e8eaef;border-radius:7px;cursor:grab;transition:all .15s}
  .registered-item:hover{background:#eef1ff;border-color:#c0ccff}
  .registered-item-icon{font-size:16px;flex-shrink:0}.registered-item-icon img{width:20px;height:20px;object-fit:contain;vertical-align:middle}.registered-item-info{flex:1;min-width:0}
  .registered-item-name{font-size:11px;color:#444;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .registered-item-path{font-size:8px;color:#aaa;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:1px;font-family:monospace}
  .registered-item-del{background:none;border:none;color:#ccc;cursor:pointer;font-size:12px;padding:2px;border-radius:3px}
  .registered-item-del:hover{color:#e44;background:#fff0f0}
  .new-template-wrap{margin-top:6px;padding:8px;background:#f0f2ff;border:1px solid #d0d8ff;border-radius:7px;display:none}
  .new-template-wrap.visible{display:block}
  .new-template-input{width:100%;background:#fff;border:1px solid #dcdee4;border-radius:4px;color:#333;padding:6px 8px;font-size:11px;outline:none;resize:vertical;min-height:50px;font-family:inherit}
  .new-template-actions{display:flex;gap:4px;margin-top:6px;justify-content:flex-end}
  .drag-ghost{position:fixed;pointer-events:none;z-index:1000;background:#4a6cf7;border-radius:8px;padding:6px 12px;font-size:11px;color:#fff;box-shadow:0 4px 16px rgba(74,108,247,0.3);display:none;max-width:200px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(20px);background:#4a6cf7;color:white;padding:8px 20px;border-radius:7px;font-size:12px;font-weight:500;opacity:0;transition:all .3s;pointer-events:none;z-index:200}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
  .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.3);z-index:100;display:none;align-items:center;justify-content:center}
  .modal-overlay.visible{display:flex}
  .modal{background:#fff;border:1px solid #d0d8ff;border-radius:12px;padding:20px;width:360px;box-shadow:0 20px 50px rgba(0,0,0,0.15)}
  .modal-title{font-size:14px;font-weight:600;color:#4a6cf7;margin-bottom:12px}
  .emoji-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:3px;max-height:250px;overflow-y:auto}
  .emoji-btn{width:34px;height:34px;border:none;background:#f8f9fc;border-radius:6px;font-size:18px;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center}
  .emoji-btn:hover{background:#eef1ff;transform:scale(1.15)}
  .modal-actions{display:flex;justify-content:flex-end;gap:6px;margin-top:12px}
  .browse-modal{width:440px}
  .browse-input{width:100%;background:#f8f9fc;border:1px solid #dcdee4;border-radius:5px;color:#333;padding:7px 10px;font-size:12px;outline:none;font-family:monospace;margin-bottom:8px}
  .browse-input:focus{border-color:#4a6cf7;background:#fff}
  .browse-name-row{display:flex;gap:6px;align-items:center;margin-bottom:8px}
  .browse-label{font-size:10px;color:#888;min-width:50px}
  .preview-float{position:fixed;bottom:14px;right:284px;width:130px;height:130px;background:#fff;border:1px solid #e0e2e8;border-radius:14px;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 12px rgba(0,0,0,0.06)}
  .preview-float-label{position:absolute;bottom:-18px;font-size:9px;color:#bbb;text-align:center;width:100%}
  .preview-svg{width:110px;height:110px}
  .preview-sector{fill:#f0f2f8;stroke:#d0d4e0;stroke-width:.8}.preview-sector.highlight{fill:#dce3ff;stroke:#4a6cf7}
  .setting-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f0f1f4}
  .setting-label-group{display:flex;flex-direction:column;gap:1px}.setting-label{font-size:12px;color:#444}.setting-desc{font-size:10px;color:#aaa}
  .toggle{width:38px;height:20px;background:#ddd;border-radius:10px;cursor:pointer;position:relative;transition:background .3s}.toggle.on{background:#4a6cf7}
  .toggle-knob{width:16px;height:16px;background:#fff;border-radius:50%;position:absolute;top:2px;left:2px;transition:all .3s;box-shadow:0 1px 3px rgba(0,0,0,0.15)}.toggle.on .toggle-knob{left:20px}
  .setting-number{width:55px;background:#f8f9fc;border:1px solid #dcdee4;border-radius:5px;color:#333;padding:4px 6px;font-size:12px;text-align:center;outline:none}
  .setting-select{background:#f8f9fc;border:1px solid #dcdee4;border-radius:5px;color:#333;padding:4px 8px;font-size:12px;outline:none;cursor:pointer}
  .hotkey-row{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid #f0f1f4}
  .hotkey-label{font-size:12px;color:#444;flex:1}
  .hotkey-input{background:#f8f9fc;border:1px solid #dcdee4;border-radius:5px;color:#4a6cf7;padding:5px 12px;font-size:11px;font-weight:600;text-align:center;min-width:140px;cursor:pointer;transition:all .2s}
  .hotkey-input:hover{border-color:#4a6cf7;background:#f0f2ff}
  .hotkey-input.recording{border-color:#f90;color:#f90;animation:pulse 1s infinite}
  @keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(255,153,0,.2)}50%{box-shadow:0 0 0 5px rgba(255,153,0,0)}}
  .status-bar{padding:6px 20px;background:#fff;border-top:1px solid #e0e2e8;font-size:10px;color:#aaa;display:flex;justify-content:space-between}
</style>
</head>
<body>
<div class="header"><div class="header-title" id="headerTitle">âš™ï¸ Ring-Link è¨­å®š</div><div class="header-right"><button class="header-btn" onclick="exportConfig()">ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button><button class="header-btn" onclick="importConfig()">ğŸ“¥ ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button><button class="header-btn primary" onclick="window.close()">âœ• é–‰ã˜ã‚‹</button></div></div>
<div class="layout">
  <div class="sidebar"><div class="sidebar-title">æ¥­å‹™ã‚¿ãƒ–</div><div class="tab-list" id="tabList"></div><div class="tab-add-btn" onclick="addNewTab()">ï¼‹ ã‚¿ãƒ–ã‚’è¿½åŠ </div><div class="sidebar-nav"><div class="sidebar-title">å…¨èˆ¬è¨­å®š</div><div class="tab-item" onclick="showView('hotkey')" id="navHotkey"><span class="tab-item-icon">âŒ¨ï¸</span><span class="tab-item-name">ãƒ›ãƒƒãƒˆã‚­ãƒ¼</span></div><div class="tab-item" onclick="showView('clipboard')" id="navClipboard"><span class="tab-item-icon">ğŸ“‹</span><span class="tab-item-name">ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰</span></div><div class="tab-item" onclick="showView('appearance')" id="navAppearance"><span class="tab-item-icon">ğŸ¨</span><span class="tab-item-name">å¤–è¦³ãƒ»ä¸€èˆ¬</span></div></div></div>
  <div class="main">
    <div id="tabEditView"><div class="edit-header"><div class="edit-tab-icon" id="editTabIcon" onclick="openEmojiPicker('tab')">âš™ï¸</div><div><input class="edit-tab-name-input" id="editTabName" value="" oninput="onTabNameChange()"><div class="edit-tab-desc" id="editTabDesc">å³ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ã‚¹ãƒ­ãƒƒãƒˆã«é…ç½®</div></div><div class="edit-tab-actions"><button class="btn btn-secondary" onclick="duplicateTab()" id="btnDuplicate">ğŸ“„ è¤‡è£½</button><button class="btn btn-danger" onclick="deleteTab()" id="btnDelete">ğŸ—‘ï¸ å‰Šé™¤</button></div></div><div class="edit-content"><div class="content-label" id="menuSlotsLabel">ğŸ¯ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ­ãƒƒãƒˆï¼ˆ8å€‹ï¼‰</div><div id="sectorGridArea"></div></div></div>
    <div id="hotkeyView" style="display:none"><div class="edit-header"><div style="font-size:28px">âŒ¨ï¸</div><div><div style="font-size:18px;font-weight:600" id="hotkeyTitle">ãƒ›ãƒƒãƒˆã‚­ãƒ¼è¨­å®š</div><div class="edit-tab-desc" id="hotkeyDesc">ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ç™»éŒ²</div></div></div><div class="edit-content" id="hotkeyContent"></div></div>
    <div id="clipboardView" style="display:none"><div class="edit-header"><div style="font-size:28px">ğŸ“‹</div><div><div style="font-size:18px;font-weight:600" id="clipTitle">ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰è¨­å®š</div></div></div><div class="edit-content" id="clipboardContent"></div></div>
    <div id="appearanceView" style="display:none"><div class="edit-header"><div style="font-size:28px">ğŸ¨</div><div><div style="font-size:18px;font-weight:600" id="appTitle">å¤–è¦³ãƒ»ä¸€èˆ¬è¨­å®š</div></div></div><div class="edit-content" id="appearanceContent"></div></div>
  </div>
  <div class="palette" id="palettePanel"><div class="palette-header" id="paletteHeader">ğŸ§© ãƒ‘ãƒ¼ãƒ„ãƒ‘ãƒ¬ãƒƒãƒˆ</div><div class="palette-tabs"><div class="palette-tab active" data-pt="templates" onclick="switchPaletteTab(this)" id="ptTemplates">å®šå‹æ–‡</div><div class="palette-tab" data-pt="launch" onclick="switchPaletteTab(this)" id="ptLaunch">èµ·å‹•</div><div class="palette-tab" data-pt="system" onclick="switchPaletteTab(this)" id="ptSystem">ã‚·ã‚¹ãƒ†ãƒ </div></div><div class="palette-content" id="paletteContent"></div></div>
</div>
<div class="preview-float" id="previewFloat"><svg class="preview-svg" id="previewSvg" viewBox="0 0 110 110"></svg><div class="preview-float-label" id="previewLabel">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div></div>
<div class="drag-ghost" id="dragGhost"></div>
<div class="modal-overlay" id="emojiModal"><div class="modal"><div class="modal-title" id="emojiModalTitle">ã‚¢ã‚¤ã‚³ãƒ³ã‚’é¸æŠ</div><div class="emoji-grid" id="emojiGrid"></div><div class="modal-actions"><button class="btn btn-secondary" onclick="closeEmojiPicker()" id="emojiCancelBtn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button></div></div></div>
<div class="modal-overlay" id="browseModal"><div class="modal browse-modal"><div class="modal-title" id="browseModalTitle">ğŸ“‚ ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ / ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç™»éŒ²</div><div style="font-size:11px;color:#888;margin-bottom:12px"><span id="browseModalDesc"></span></div><div class="drop-zone" id="modalDropZone"><div class="drop-zone-icon">ğŸ“</div><div class="drop-zone-main"><span id="modalDropText"></span></div></div><div class="dialog-btns"><div class="dialog-btn" onclick="dialogSelectFile('modal')" id="modalSelectFile">ğŸ“„ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</div><div class="dialog-btn" onclick="dialogSelectFolder('modal')" id="modalSelectFolder">ğŸ“‚ ãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠ</div></div><div style="text-align:center;font-size:9px;color:#bbb;margin:4px 0"><span id="manualInputLabel">â”€â”€ ã¾ãŸã¯æ‰‹å‹•å…¥åŠ› â”€â”€</span></div><input class="browse-input" id="browsePathInput" placeholder="C:\Users\...\Desktop\app.lnk"><div class="browse-name-row"><span class="browse-label" id="browseLabelName">è¡¨ç¤ºå</span><input class="browse-input" id="browseNameInput" placeholder="ã‚¢ãƒ—ãƒªå" id="browseNameField" style="margin:0"></div><div class="browse-name-row"><span class="browse-label" id="browseLabelIcon">ã‚¢ã‚¤ã‚³ãƒ³</span><div style="display:flex;align-items:center;gap:8px"><div id="browseIconPreview" style="width:32px;height:32px;border-radius:6px;background:#f0f2f8;border:1px solid #ddd;display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer" onclick="openEmojiPicker('browse')">ğŸ“</div><span style="font-size:10px;color:#aaa"><span id="clickChangeLabel">ã‚¯ãƒªãƒƒã‚¯å¤‰æ›´</span></span></div></div><div class="modal-actions"><button class="btn btn-secondary" onclick="closeBrowseModal()" id="browseCancelBtn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button><button class="btn btn-primary" onclick="registerFromBrowse()" id="browseRegisterBtn">âœ… ç™»éŒ²</button></div></div></div>
<div class="status-bar"><span id="statusText">Loading...</span><span id="statusVersion"></span></div>
<div class="toast" id="toast"></div>
<script>
// Electronã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‰ãƒ­ãƒƒãƒ—æŒ™å‹•ã‚’å®Œå…¨ã«ç„¡åŠ¹åŒ–ï¼ˆãƒšãƒ¼ã‚¸é·ç§»é˜²æ­¢ï¼‰
document.addEventListener('dragover',e=>e.preventDefault(),true);
document.addEventListener('drop',e=>e.preventDefault(),true);

let configData=null,currentTabIndex=0,editingSectorIndex=-1,emojiTarget=null,currentPaletteTab='templates',browseIcon='ğŸ“';
const posNamesI18N={ja:['ä¸Š','å³ä¸Š','å³','å³ä¸‹','ä¸‹','å·¦ä¸‹','å·¦','å·¦ä¸Š'],en:['Top','TR','Right','BR','Bottom','BL','Left','TL'],fr:['Haut','HD','Droite','BD','Bas','BG','Gauche','HG'],zh:['ä¸Š','å³ä¸Š','å³','å³ä¸‹','ä¸‹','å·¦ä¸‹','å·¦','å·¦ä¸Š']};function getPosNames(){return posNamesI18N[lang]||posNamesI18N.ja;}
const emojis=['ğŸ“','ğŸ“‚','ğŸ“„','ğŸ“‹','ğŸ“‘','ğŸ“','ğŸ“Š','ğŸ“ˆ','ğŸ“‰','ğŸ’°','ğŸ’³','ğŸ¦','ğŸ§®','ğŸ“§','ğŸ’¬','ğŸ“…','ğŸ”','âš™ï¸','â“','ğŸŒ','ğŸ“¦','ğŸšš','ğŸ“¸','ğŸ¨','ğŸ–¨ï¸','ğŸŒ','ğŸ®','ğŸ’»','ğŸ™','ğŸ§ª','ğŸ“–','ğŸ²','ğŸ¯','ğŸ”§','ğŸ”‘','ğŸ“Œ','â­','â¤ï¸','ğŸ””','ğŸ—‚ï¸','ğŸ’¼','ğŸ ','â˜ï¸','ğŸ–¥ï¸','âŒ¨ï¸','ğŸ–±ï¸','ğŸ”’','âœ…','âŒ','â•','âœï¸','ğŸ—‘ï¸','ğŸ’¡','ğŸš€','ğŸµ','ğŸ¥½','ğŸ“±','ğŸ–¼ï¸','ğŸ“','ğŸ’','ğŸ“·','âœ‚ï¸','ğŸ—ƒï¸'];
function getSystemItems(){return [{icon:'ğŸ“‹',label:t('clipHistory'),type:'clipboard',target:''},{icon:'ğŸ“‘',label:t('templateList'),type:'templates',target:''},{icon:'ğŸ”',label:lang==='ja'?'ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢':lang==='zh'?'æ–‡ä»¶æœç´¢':lang==='fr'?'Recherche':'File Search',type:'launch',target:'Everything.exe'},{icon:'âš™ï¸',label:'Ring-Link '+t('settings'),type:'launch',target:'settings'},{icon:'ğŸ”’',label:lang==='ja'?'ç”»é¢ãƒ­ãƒƒã‚¯':lang==='zh'?'é”å±':lang==='fr'?'Verrouiller':'Lock Screen',type:'launch',target:'rundll32.exe user32.dll,LockWorkStation'}];}
function iconHtml(iconOrData,size){size=size||28;if(iconOrData&&iconOrData.startsWith('data:image'))return '<img src="'+iconOrData+'" style="width:'+size+'px;height:'+size+'px;object-fit:contain">';return iconOrData||'ğŸ“';}

const I18N={
ja:{settings:'Ring-Link è¨­å®š',export:'ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ',import:'ã‚¤ãƒ³ãƒãƒ¼ãƒˆ',close:'é–‰ã˜ã‚‹',businessTabs:'æ¥­å‹™ã‚¿ãƒ–',addTab:'ï¼‹ ã‚¿ãƒ–ã‚’è¿½åŠ ',generalSettings:'å…¨èˆ¬è¨­å®š',hotkeys:'ãƒ›ãƒƒãƒˆã‚­ãƒ¼',clipboard:'ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰',appearanceGeneral:'å¤–è¦³ãƒ»ä¸€èˆ¬',hotkeySettings:'ãƒ›ãƒƒãƒˆã‚­ãƒ¼è¨­å®š',hotkeyDesc:'ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ç™»éŒ²',clipboardSettings:'ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰è¨­å®š',appearanceSettings:'å¤–è¦³ãƒ»ä¸€èˆ¬è¨­å®š',partsPalette:'ãƒ‘ãƒ¼ãƒ„ãƒ‘ãƒ¬ãƒƒãƒˆ',templates:'å®šå‹æ–‡',launch:'èµ·å‹•',system:'ã‚·ã‚¹ãƒ†ãƒ ',autoStart:'PCèµ·å‹•æ™‚ã«è‡ªå‹•èµ·å‹•',autoStartDesc:'ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã«ç™»éŒ²',appearance:'å¤–è¦³',theme:'ãƒ†ãƒ¼ãƒ',themeDesc:'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®é…è‰²ã‚’åˆ‡æ›¿',themeDark:'ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰',themeLight:'ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰',themePink:'ğŸŒ¸ ãƒ”ãƒ³ã‚¯ãƒ¢ãƒ¼ãƒ‰',menuSize:'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚µã‚¤ã‚º (px)',opacity:'é€éåº¦ %',animation:'ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³',language:'è¨€èª',languageDesc:'è¡¨ç¤ºè¨€èªã‚’å¤‰æ›´',unset:'æœªè¨­å®š',dropOrClick:'ãƒ‰ãƒ­ãƒƒãƒ— or ã‚¯ãƒªãƒƒã‚¯',save:'ä¿å­˜',delete:'å‰Šé™¤',duplicate:'è¤‡è£½',clear:'ã‚¯ãƒªã‚¢',cancel:'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',register:'ç™»éŒ²',change:'å¤‰æ›´',menuSlots:'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ­ãƒƒãƒˆï¼ˆ8å€‹ï¼‰',clipMonitor:'ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ç›£è¦–',clipMonitorDesc:'ã‚³ãƒ”ãƒ¼å†…å®¹ã‚’è‡ªå‹•ä¿å­˜',maxHistory:'æœ€å¤§ä¿å­˜ä»¶æ•°',saveImages:'ç”»åƒã‚‚ä¿å­˜',excludePasswords:'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰é™¤å¤–',toggleMenu:'ãƒ¡ãƒ‹ãƒ¥ãƒ¼å‘¼ã³å‡ºã—',clipHistory:'ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰å±¥æ­´',templateList:'å®šå‹æ–‡ä¸€è¦§',screenshotClip:'ç¯„å›²ã‚­ãƒ£ãƒ—ãƒãƒ£ â†’ CLP',screenshotSave:'ç¯„å›²ã‚­ãƒ£ãƒ—ãƒãƒ£ â†’ ä¿å­˜',openSettings:'è¨­å®šç”»é¢ã‚’é–‹ã',nextTab:'æ¬¡ã®ã‚¿ãƒ–',prevTab:'å‰ã®ã‚¿ãƒ–',newTab:'æ–°ã—ã„ã‚¿ãƒ–',lastTab:'æœ€å¾Œã®ã‚¿ãƒ–',noHistory:'å±¥æ­´ãªã—',copied:'ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ',saved:'ä¿å­˜å®Œäº†',icon:'ã‚¢ã‚¤ã‚³ãƒ³',displayName:'è¡¨ç¤ºå',actionType:'ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®é¡',target:'ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼ˆãƒ‘ã‚¹/URLï¼‰',textContent:'ãƒ†ã‚­ã‚¹ãƒˆå†…å®¹',saveFolder:'ä¿å­˜å…ˆãƒ•ã‚©ãƒ«ãƒ€',notRequired:'è¨­å®šä¸è¦',clipboardCopy:'ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼',dragToSlot:''+t('dragToSlot')+'',builtIn:'çµ„ã¿è¾¼ã¿æ©Ÿèƒ½',systemFeatures:'ã‚·ã‚¹ãƒ†ãƒ æ©Ÿèƒ½',registeredShortcuts:'ç™»éŒ²æ¸ˆã¿ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ',selectFile:'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ',selectFolder:'ãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠ',dropFileFolder:'ãƒ•ã‚¡ã‚¤ãƒ« / ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã“ã“ã«ãƒ‰ãƒ­ãƒƒãƒ—',shortcutOrFolder:'ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ / ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç™»éŒ²',orManualInput:'<span id="manualInputLabel">â”€â”€ ã¾ãŸã¯æ‰‹å‹•å…¥åŠ› â”€â”€</span>',appName:'ã‚¢ãƒ—ãƒªå',clickToChange:'<span id="clickChangeLabel">ã‚¯ãƒªãƒƒã‚¯å¤‰æ›´</span>',commonTemplates:'å…±é€šå®šå‹æ–‡',addNew:'è¿½åŠ ',newTemplatePlaceholder:'æ–°ã—ã„å®šå‹æ–‡ã‚’å…¥åŠ›...',scrollToSwitch:'ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§ã‚¿ãƒ–åˆ‡æ›¿',clipboardPanel:'CLIPBOARD',pasteWithCtrlV:''+t('pasteWithCtrlV')+'',saveToFolder:''+t('saveToFolder')+'',dropShortcutFolder:'ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ / ãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒ‰ãƒ­ãƒƒãƒ—',appFileLaunch:'ã‚¢ãƒ—ãƒª/ãƒ•ã‚¡ã‚¤ãƒ«',templateDirect:'å®šå‹æ–‡ï¼ˆç›´æ¥è²¼ã‚Šä»˜ã‘ï¼‰',clipHistoryAction:'ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰å±¥æ­´',templateListAction:'å®šå‹æ–‡ä¸€è¦§',captureClip:'ç¯„å›²ã‚­ãƒ£ãƒ—ãƒãƒ£ â†’ CLP',captureSave:'ç¯„å›²ã‚­ãƒ£ãƒ—ãƒãƒ£ â†’ ä¿å­˜',hotkeyRecording:'ã‚­ãƒ¼ã‚’å…¥åŠ›...',exportDone:'ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†',importDone:'ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†',tabAdded:'ã‚¿ãƒ–è¿½åŠ ',duplicated:'è¤‡è£½',deleted:'å‰Šé™¤',cleared:'ã‚¯ãƒªã‚¢',savedMsg:'ä¿å­˜ã—ã¾ã—ãŸ',placedAt:'ã«é…ç½®',hotkeysSaved:'ãƒ›ãƒƒãƒˆã‚­ãƒ¼ä¿å­˜å®Œäº†',clipSaved:'ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰è¨­å®šä¿å­˜',appSaved:'å¤–è¦³è¨­å®šä¿å­˜',loadError:'èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼',saveError:'ä¿å­˜ã‚¨ãƒ©ãƒ¼',enterPath:'ãƒ‘ã‚¹ã‚’å…¥åŠ›',iconReset:'ã‚¢ã‚¤ã‚³ãƒ³ãƒªã‚»ãƒƒãƒˆ'},
en:{settings:'Ring-Link Settings',export:'Export',import:'Import',close:'Close',businessTabs:'Work Tabs',addTab:'+ Add Tab',generalSettings:'General',hotkeys:'Hotkeys',clipboard:'Clipboard',appearanceGeneral:'Appearance',hotkeySettings:'Hotkey Settings',hotkeyDesc:'Click and press keys to register',clipboardSettings:'Clipboard Settings',appearanceSettings:'Appearance Settings',partsPalette:'Parts Palette',templates:'Templates',launch:'Launch',system:'System',autoStart:'Launch on startup',autoStartDesc:'Register to startup',appearance:'Appearance',theme:'Theme',themeDesc:'Change menu color scheme',themeDark:'Dark Mode',themeLight:'Light Mode',themePink:'ğŸŒ¸ Pink Mode',menuSize:'Menu Size (px)',opacity:'Opacity %',animation:'Animation',language:'Language',languageDesc:'Change display language',unset:'Empty',dropOrClick:'Drop or Click',save:'Save',delete:'Delete',duplicate:'Duplicate',clear:'Clear',cancel:'Cancel',register:'Register',change:'Change',menuSlots:'Menu Slots (8)',clipMonitor:'Clipboard Monitor',clipMonitorDesc:'Auto-save copied content',maxHistory:'Max History',saveImages:'Save Images',excludePasswords:'Exclude Passwords',toggleMenu:'Toggle Menu',clipHistory:'Clipboard History',templateList:'Template List',screenshotClip:'Capture â†’ Clipboard',screenshotSave:'Capture â†’ Save',openSettings:'Open Settings',nextTab:'Next Tab',prevTab:'Previous Tab',newTab:'New Tab',lastTab:'Last tab',noHistory:'No history',copied:'Copied',saved:'Saved',icon:'Icon',displayName:'Display Name',actionType:'Action Type',target:'Target (Path/URL)',textContent:'Text Content',saveFolder:'Save Folder',notRequired:'Not required',clipboardCopy:'Copy to clipboard',dragToSlot:'Drag to slot',builtIn:'Built-in',systemFeatures:'System Features',registeredShortcuts:'Registered Shortcuts',selectFile:'Select File',selectFolder:'Select Folder',dropFileFolder:'Drop files/folders here',shortcutOrFolder:'Register Shortcut/Folder',orManualInput:'â”€â”€ or manual input â”€â”€',appName:'App Name',clickToChange:'Click to change',commonTemplates:'Common Templates',addNew:'Add',newTemplatePlaceholder:'Enter new template...',scrollToSwitch:'Scroll to switch tabs',clipboardPanel:'CLIPBOARD',pasteWithCtrlV:'Paste with Ctrl+V',saveToFolder:'Save to folder',dropShortcutFolder:'Drop shortcuts/folders',appFileLaunch:'App/File',templateDirect:'Template (direct paste)',clipHistoryAction:'Clipboard History',templateListAction:'Template List',captureClip:'Capture â†’ Clipboard',captureSave:'Capture â†’ Save',hotkeyRecording:'Press keys...',exportDone:'Exported',importDone:'Imported',tabAdded:'Tab added',duplicated:'Duplicated',deleted:'Deleted',cleared:'Cleared',savedMsg:'Saved',placedAt:' placed',hotkeysSaved:'Hotkeys saved',clipSaved:'Clipboard settings saved',appSaved:'Appearance saved',loadError:'Load error',saveError:'Save error',enterPath:'Enter path',iconReset:'Icon reset'},
fr:{settings:'Ring-Link ParamÃ¨tres',export:'Exporter',import:'Importer',close:'Fermer',businessTabs:'Onglets',addTab:'+ Ajouter',generalSettings:'GÃ©nÃ©ral',hotkeys:'Raccourcis',clipboard:'Presse-papiers',appearanceGeneral:'Apparence',hotkeySettings:'Raccourcis clavier',hotkeyDesc:'Cliquez et appuyez pour enregistrer',clipboardSettings:'ParamÃ¨tres presse-papiers',appearanceSettings:'ParamÃ¨tres d\'apparence',partsPalette:'Palette',templates:'ModÃ¨les',launch:'Lancer',system:'SystÃ¨me',autoStart:'Lancer au dÃ©marrage',autoStartDesc:'Ajouter au dÃ©marrage',appearance:'Apparence',theme:'ThÃ¨me',themeDesc:'Changer les couleurs du menu',themeDark:'Mode Sombre',themeLight:'Mode Clair',themePink:'ğŸŒ¸ Mode Rose',menuSize:'Taille menu (px)',opacity:'OpacitÃ© %',animation:'Animation',language:'Langue',languageDesc:'Changer la langue',unset:'Vide',dropOrClick:'Glisser ou cliquer',save:'Sauver',delete:'Supprimer',duplicate:'Dupliquer',clear:'Effacer',cancel:'Annuler',register:'Enregistrer',change:'Modifier',menuSlots:'Emplacements (8)',clipMonitor:'Surveillance presse-papiers',clipMonitorDesc:'Sauvegarder auto le contenu copiÃ©',maxHistory:'Historique max',saveImages:'Sauver images',excludePasswords:'Exclure mots de passe',toggleMenu:'Afficher menu',clipHistory:'Historique presse-papiers',templateList:'Liste modÃ¨les',screenshotClip:'Capture â†’ Presse-papiers',screenshotSave:'Capture â†’ Sauver',openSettings:'Ouvrir paramÃ¨tres',nextTab:'Onglet suivant',prevTab:'Onglet prÃ©cÃ©dent',newTab:'Nouvel onglet',lastTab:'Dernier onglet',noHistory:'Aucun historique',copied:'CopiÃ©',saved:'SauvegardÃ©',icon:'IcÃ´ne',displayName:'Nom',actionType:'Type d\'action',target:'Cible (chemin/URL)',textContent:'Contenu texte',saveFolder:'Dossier de sauvegarde',notRequired:'Non requis',clipboardCopy:'Copier dans le presse-papiers',dragToSlot:'Glisser vers l\'emplacement',builtIn:'IntÃ©grÃ©',systemFeatures:'Fonctions systÃ¨me',registeredShortcuts:'Raccourcis enregistrÃ©s',selectFile:'SÃ©lectionner fichier',selectFolder:'SÃ©lectionner dossier',dropFileFolder:'DÃ©poser fichiers/dossiers ici',shortcutOrFolder:'Enregistrer raccourci/dossier',orManualInput:'â”€â”€ ou saisie manuelle â”€â”€',appName:'Nom appli',clickToChange:'Cliquer pour modifier',commonTemplates:'ModÃ¨les communs',addNew:'Ajouter',newTemplatePlaceholder:'Entrer un nouveau modÃ¨le...',scrollToSwitch:'DÃ©filer pour changer d\'onglet',clipboardPanel:'PRESSE-PAPIERS',pasteWithCtrlV:'Coller avec Ctrl+V',saveToFolder:'Sauver dans un dossier',dropShortcutFolder:'DÃ©poser raccourcis/dossiers',appFileLaunch:'App/Fichier',templateDirect:'ModÃ¨le (collage direct)',clipHistoryAction:'Historique presse-papiers',templateListAction:'Liste de modÃ¨les',captureClip:'Capture â†’ Presse-papiers',captureSave:'Capture â†’ Sauver',hotkeyRecording:'Appuyez...',exportDone:'ExportÃ©',importDone:'ImportÃ©',tabAdded:'Onglet ajoutÃ©',duplicated:'DupliquÃ©',deleted:'SupprimÃ©',cleared:'EffacÃ©',savedMsg:'SauvegardÃ©',placedAt:' placÃ©',hotkeysSaved:'Raccourcis sauvegardÃ©s',clipSaved:'Presse-papiers sauvegardÃ©',appSaved:'Apparence sauvegardÃ©e',loadError:'Erreur chargement',saveError:'Erreur sauvegarde',enterPath:'Entrer chemin',iconReset:'IcÃ´ne rÃ©initialisÃ©e'},
zh:{settings:'Ring-Link è®¾ç½®',export:'å¯¼å‡º',import:'å¯¼å…¥',close:'å…³é—­',businessTabs:'å·¥ä½œæ ‡ç­¾',addTab:'ï¼‹ æ·»åŠ æ ‡ç­¾',generalSettings:'é€šç”¨è®¾ç½®',hotkeys:'å¿«æ·é”®',clipboard:'å‰ªè´´æ¿',appearanceGeneral:'å¤–è§‚Â·é€šç”¨',hotkeySettings:'å¿«æ·é”®è®¾ç½®',hotkeyDesc:'ç‚¹å‡»åæŒ‰ä¸‹æŒ‰é”®è¿›è¡Œæ³¨å†Œ',clipboardSettings:'å‰ªè´´æ¿è®¾ç½®',appearanceSettings:'å¤–è§‚Â·é€šç”¨è®¾ç½®',partsPalette:'éƒ¨ä»¶é¢æ¿',templates:'æ¨¡æ¿',launch:'å¯åŠ¨',system:'ç³»ç»Ÿ',autoStart:'å¼€æœºè‡ªå¯åŠ¨',autoStartDesc:'æ·»åŠ åˆ°å¯åŠ¨é¡¹',appearance:'å¤–è§‚',theme:'ä¸»é¢˜',themeDesc:'åˆ‡æ¢èœå•é…è‰²',themeDark:'æ·±è‰²æ¨¡å¼',themeLight:'æµ…è‰²æ¨¡å¼',themePink:'ğŸŒ¸ ç²‰è‰²æ¨¡å¼',menuSize:'èœå•å¤§å° (px)',opacity:'é€æ˜åº¦ %',animation:'åŠ¨ç”»',language:'è¯­è¨€',languageDesc:'æ›´æ”¹æ˜¾ç¤ºè¯­è¨€',unset:'æœªè®¾ç½®',dropOrClick:'æ‹–æ”¾æˆ–ç‚¹å‡»',save:'ä¿å­˜',delete:'åˆ é™¤',duplicate:'å¤åˆ¶',clear:'æ¸…é™¤',cancel:'å–æ¶ˆ',register:'æ³¨å†Œ',change:'æ›´æ”¹',menuSlots:'èœå•æ§½ä½ï¼ˆ8ä¸ªï¼‰',clipMonitor:'å‰ªè´´æ¿ç›‘æ§',clipMonitorDesc:'è‡ªåŠ¨ä¿å­˜å¤åˆ¶å†…å®¹',maxHistory:'æœ€å¤§ä¿å­˜æ•°',saveImages:'ä¿å­˜å›¾ç‰‡',excludePasswords:'æ’é™¤å¯†ç ',toggleMenu:'æ˜¾ç¤ºèœå•',clipHistory:'å‰ªè´´æ¿å†å²',templateList:'æ¨¡æ¿åˆ—è¡¨',screenshotClip:'æˆªå›¾ â†’ å‰ªè´´æ¿',screenshotSave:'æˆªå›¾ â†’ ä¿å­˜',openSettings:'æ‰“å¼€è®¾ç½®',nextTab:'ä¸‹ä¸€æ ‡ç­¾',prevTab:'ä¸Šä¸€æ ‡ç­¾',newTab:'æ–°æ ‡ç­¾',lastTab:'æœ€åçš„æ ‡ç­¾',noHistory:'æ— å†å²',copied:'å·²å¤åˆ¶',saved:'å·²ä¿å­˜',icon:'å›¾æ ‡',displayName:'æ˜¾ç¤ºåç§°',actionType:'æ“ä½œç±»å‹',target:'ç›®æ ‡ï¼ˆè·¯å¾„/URLï¼‰',textContent:'æ–‡æœ¬å†…å®¹',saveFolder:'ä¿å­˜æ–‡ä»¶å¤¹',notRequired:'æ— éœ€è®¾ç½®',clipboardCopy:'å¤åˆ¶åˆ°å‰ªè´´æ¿',dragToSlot:'æ‹–åˆ°æ§½ä½',builtIn:'å†…ç½®åŠŸèƒ½',systemFeatures:'ç³»ç»ŸåŠŸèƒ½',registeredShortcuts:'å·²æ³¨å†Œå¿«æ·æ–¹å¼',selectFile:'é€‰æ‹©æ–‡ä»¶',selectFolder:'é€‰æ‹©æ–‡ä»¶å¤¹',dropFileFolder:'å°†æ–‡ä»¶/æ–‡ä»¶å¤¹æ‹–åˆ°æ­¤å¤„',shortcutOrFolder:'æ³¨å†Œå¿«æ·æ–¹å¼/æ–‡ä»¶å¤¹',orManualInput:'â”€â”€ æˆ–æ‰‹åŠ¨è¾“å…¥ â”€â”€',appName:'åº”ç”¨å',clickToChange:'ç‚¹å‡»æ›´æ”¹',commonTemplates:'é€šç”¨æ¨¡æ¿',addNew:'æ·»åŠ ',newTemplatePlaceholder:'è¾“å…¥æ–°æ¨¡æ¿...',scrollToSwitch:'æ»šåŠ¨åˆ‡æ¢æ ‡ç­¾',clipboardPanel:'å‰ªè´´æ¿',pasteWithCtrlV:'Ctrl+Vç²˜è´´',saveToFolder:'ä¿å­˜åˆ°æ–‡ä»¶å¤¹',dropShortcutFolder:'æ‹–æ”¾å¿«æ·æ–¹å¼/æ–‡ä»¶å¤¹',appFileLaunch:'åº”ç”¨/æ–‡ä»¶',templateDirect:'æ¨¡æ¿ï¼ˆç›´æ¥ç²˜è´´ï¼‰',clipHistoryAction:'å‰ªè´´æ¿å†å²',templateListAction:'æ¨¡æ¿åˆ—è¡¨',captureClip:'æˆªå›¾ â†’ å‰ªè´´æ¿',captureSave:'æˆªå›¾ â†’ ä¿å­˜',hotkeyRecording:'è¯·æŒ‰é”®...',exportDone:'å·²å¯¼å‡º',importDone:'å·²å¯¼å…¥',tabAdded:'æ ‡ç­¾å·²æ·»åŠ ',duplicated:'å·²å¤åˆ¶',deleted:'å·²åˆ é™¤',cleared:'å·²æ¸…é™¤',savedMsg:'å·²ä¿å­˜',placedAt:'å·²æ”¾ç½®',hotkeysSaved:'å¿«æ·é”®å·²ä¿å­˜',clipSaved:'å‰ªè´´æ¿è®¾ç½®å·²ä¿å­˜',appSaved:'å¤–è§‚è®¾ç½®å·²ä¿å­˜',loadError:'åŠ è½½é”™è¯¯',saveError:'ä¿å­˜é”™è¯¯',enterPath:'è¯·è¾“å…¥è·¯å¾„',iconReset:'å›¾æ ‡å·²é‡ç½®'}
};
let lang='ja';
function initLang(){try{lang=(configData.appearance||{}).language||'ja';}catch(e){lang='ja';}if(!I18N[lang])lang='ja';}
function t(key){return (I18N[lang]||I18N.ja)[key]||(I18N.ja)[key]||key;}

function getHotkeyDefs(){return [{key:'toggleMenu',label:t('toggleMenu')},{key:'clipboardHistory',label:t('clipHistory')},{key:'templateList',label:t('templateList')},{key:'screenshotClip',label:t('screenshotClip')},{key:'screenshotSave',label:t('screenshotSave')},{key:'openSettings',label:t('openSettings')},{key:'nextTab',label:t('nextTab')},{key:'prevTab',label:t('prevTab')}];}

async function init(){
  try{configData=await window.radialHub.config.getAll();document.getElementById('statusText').textContent='è¨­å®šèª­ã¿è¾¼ã¿å®Œäº†';document.getElementById('statusVersion').textContent='v'+(configData.version||'?');}
  catch(e){configData={tabs:[],hotkeys:{},clipboard:{},appearance:{},templates:[]};document.getElementById('statusText').textContent=t('loadError');}
  if(!configData.tabs||!configData.tabs.length)configData.tabs=[{id:'tab-default',name:'å…±é€š',icon:'âš™ï¸',items:Array(8).fill(null).map(()=>({icon:'â•',label:t('unset'),type:'launch',target:''})),registered:[]}];initLang();updateUILabels();
  configData.tabs.forEach(t=>{if(!t.registered)t.registered=[];});
  if(!configData.templates)configData.templates=[];
  renderAll();buildEmojiGrid();
}
function renderAll(){renderTabList();renderEditView();renderPreview();renderPalette();}

async function saveConfig(){try{await window.radialHub.config.set('tabs',configData.tabs);await window.radialHub.config.set('templates',configData.templates);document.getElementById('statusText').textContent='âœ… '+t('saved')+' '+new Date().toLocaleTimeString();}catch(e){document.getElementById('statusText').textContent='âŒ '+t('saveError');}}
async function saveHotkeys(){await window.radialHub.config.set('hotkeys',configData.hotkeys);window.radialHub.hotkeys.reload();document.getElementById('statusText').textContent='âœ… '+t('hotkeysSaved');}
async function exportConfig(){const r=await window.radialHub.config.export();if(r)showToast('ğŸ“¤ '+t('exportDone'));}
async function importConfig(){const r=await window.radialHub.config.import();if(r){configData=await window.radialHub.config.getAll();configData.tabs.forEach(t=>{if(!t.registered)t.registered=[];});if(!configData.templates)configData.templates=[];currentTabIndex=0;editingSectorIndex=-1;renderAll();showToast('ğŸ“¥ '+t('importDone'));}}

function renderTabList(){const list=document.getElementById('tabList');list.innerHTML='';configData.tabs.forEach((tab,i)=>{const div=document.createElement('div');div.className='tab-item'+(i===currentTabIndex?' active':'');div.innerHTML='<span class="tab-item-icon">'+tab.icon+'</span><span class="tab-item-name">'+tab.name+'</span><span class="tab-item-key">'+(i+1)+'</span><div class="tab-move-btns"><div class="tab-move-btn" onclick="event.stopPropagation();moveTab('+i+','+(i-1)+')">â–²</div><div class="tab-move-btn" onclick="event.stopPropagation();moveTab('+i+','+(i+1)+')">â–¼</div></div>';div.onclick=()=>{currentTabIndex=i;editingSectorIndex=-1;showView('tab');};list.appendChild(div);});document.querySelectorAll('#navHotkey,#navClipboard,#navAppearance').forEach(el=>el.classList.remove('active'));}
function moveTab(from,to){if(to<0||to>=configData.tabs.length)return;const t=configData.tabs.splice(from,1)[0];configData.tabs.splice(to,0,t);currentTabIndex=to;renderAll();saveConfig();}
function showView(view){['tabEditView','hotkeyView','clipboardView','appearanceView'].forEach(v=>document.getElementById(v).style.display='none');document.getElementById('palettePanel').style.display='';document.getElementById('previewFloat').style.display='';if(view==='tab'){document.getElementById('tabEditView').style.display='';renderTabList();renderEditView();renderPreview();renderPalette();}else{document.getElementById(view+'View').style.display='';document.getElementById('palettePanel').style.display='none';document.getElementById('previewFloat').style.display='none';document.querySelectorAll('.tab-item').forEach(el=>el.classList.remove('active'));const n=document.getElementById('nav'+view.charAt(0).toUpperCase()+view.slice(1));if(n)n.classList.add('active');if(view==='hotkey')renderHotkeyView();if(view==='clipboard')renderClipboardView();if(view==='appearance')renderAppearanceView();}}
function renderEditView(){const tab=configData.tabs[currentTabIndex];if(!tab)return;document.getElementById('editTabIcon').textContent=tab.icon;document.getElementById('editTabName').value=tab.name;renderSectorGrid();}

function renderSectorGrid(){const area=document.getElementById('sectorGridArea'),tab=configData.tabs[currentTabIndex];if(!tab)return;let html='<div class="sector-grid">';for(let i=0;i<8;i++){const item=tab.items[i],isEd=editingSectorIndex===i;if(item&&item.label!==t('unset')&&item.label!=='æœªè¨­å®š'){const tc=item.type==='clipboard'?'type-clipboard':item.type==='templates'?'type-templates':item.type==='text'?'type-text':item.type==='screenshot_clip'||item.type==='screenshot_save'?'type-screenshot':'type-launch';const tl=item.type==='clipboard'?t('clipboard'):item.type==='templates'?t('templateList'):item.type==='text'?t('templates'):item.type==='screenshot_clip'?'ğŸ“·â†’CLP':item.type==='screenshot_save'?'ğŸ“·â†’'+t('save'):t('appFileLaunch');html+='<div class="sector-card '+(isEd?'editing':'')+'" data-index="'+i+'" onclick="selectSector('+i+')"><div class="sector-card-num">#'+(i+1)+'</div><div class="sector-card-pos">'+getPosNames()[i]+'</div><div class="sector-card-icon">'+iconHtml(item.iconData||item.icon,32)+'</div><div class="sector-card-label">'+item.label+'</div><div class="sector-card-type-wrap"><span class="sector-card-type '+tc+'">'+tl+'</span></div><div class="sector-swap-btns"><div class="sector-swap-btn" onclick="event.stopPropagation();swapSector('+i+','+(i-1)+')">â—€</div><div class="sector-swap-btn" onclick="event.stopPropagation();swapSector('+i+','+(i+1)+')">â–¶</div></div></div>';}else{html+='<div class="sector-card empty" data-index="'+i+'" onclick="selectSector('+i+')"><div class="sector-card-num">#'+(i+1)+'</div><div class="sector-card-pos">'+getPosNames()[i]+'</div><div class="empty-icon">ï¼‹</div><div class="empty-text">'+(t('dropOrClick'))+'</div></div>';}}html+='</div>';
if(editingSectorIndex>=0){const item=tab.items[editingSectorIndex]||{icon:'â­',label:'',type:'launch',target:''};if(!tab.items[editingSectorIndex])tab.items[editingSectorIndex]=item;const isText=item.type==='text',isSS=item.type==='screenshot_clip'||item.type==='screenshot_save';html+='<div class="edit-panel"><div class="edit-panel-title">âœï¸ #'+(editingSectorIndex+1)+'ï¼ˆ'+getPosNames()[editingSectorIndex]+'ï¼‰</div><div class="form-grid"><div class="form-group"><div class="form-label">'+(t('icon'))+'</div><div style="display:flex;align-items:center;gap:8px"><div style="width:36px;height:36px;border-radius:8px;background:#f0f2f8;border:1px solid #ddd;display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer" onclick="openEmojiPicker('+editingSectorIndex+')">'+iconHtml(item.iconData||item.icon,28)+'</div><span style="font-size:10px;color:#aaa;cursor:pointer" onclick="openEmojiPicker('+editingSectorIndex+')">'+t('change')+'</span>'+(item.iconData?'<span style="font-size:9px;color:#e44;cursor:pointer;margin-left:4px" onclick="resetSectorIcon()">âœ•'+(t('iconReset'))+'</span>':'')+'</div></div><div class="form-group"><div class="form-label">'+(t('displayName'))+'</div><input class="form-input" value="'+item.label+'" onchange="updateSector(\'label\',this.value)"></div><div class="form-group"><div class="form-label">'+(t('actionType'))+'</div><select class="form-select" onchange="updateSector(\'type\',this.value);renderSectorGrid();"><option value="launch" '+(item.type==='launch'?'selected':'')+'>'+'ğŸš€ '+(t('appFileLaunch'))+' / URL</option><option value="text" '+(item.type==='text'?'selected':'')+'>'+'ğŸ“ '+(t('templateDirect'))+'</option><option value="clipboard" '+(item.type==='clipboard'?'selected':'')+'>'+'ğŸ“‹ '+(t('clipHistoryAction'))+'</option><option value="templates" '+(item.type==='templates'?'selected':'')+'>'+'ğŸ“‘ '+(t('templateListAction'))+'</option><option value="screenshot_clip" '+(item.type==='screenshot_clip'?'selected':'')+'>'+'ğŸ“· '+(t('captureClip'))+'</option><option value="screenshot_save" '+(item.type==='screenshot_save'?'selected':'')+'>'+'ğŸ’¾ '+(t('captureSave'))+'</option></select></div><div class="form-group"><div class="form-label">'+(isText?t('textContent'):isSS?(item.type==='screenshot_save'?t('saveFolder'):t('notRequired')):t('target'))+'</div>'+(isText?'<textarea class="form-textarea" onchange="updateSector(\'target\',this.value)">'+(item.target||'')+'</textarea>':isSS&&item.type==='screenshot_save'?'<input class="form-input" value="'+(item.target||'')+'" onchange="updateSector(\'target\',this.value)" placeholder="D:\\Screenshots\\">':isSS?'<div style="font-size:11px;color:#999;padding:8px">'+(t('clipboardCopy'))+'</div>':'<input class="form-input" value="'+(item.target||'')+'" onchange="updateSector(\'target\',this.value)" placeholder="C:\\... or https://..." '+(item.type!=='launch'?'disabled style="opacity:.4"':'')+'>')+'</div></div><div class="panel-actions"><button class="btn btn-danger" onclick="clearSector('+editingSectorIndex+')">ğŸ—‘ï¸ '+(t('clear'))+'</button><button class="btn btn-secondary" onclick="editingSectorIndex=-1;renderSectorGrid();">'+(t('close'))+'</button><button class="btn btn-primary" onclick="saveSector()">ğŸ’¾ '+(t('save'))+'</button></div></div>';}area.innerHTML=html;
// ã‚»ã‚¯ã‚¿ãƒ¼ã‚«ãƒ¼ãƒ‰ã«ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³è¨­å®š
document.querySelectorAll('.sector-card').forEach(card=>{card.addEventListener('dragover',e=>{e.preventDefault();e.stopPropagation();card.classList.add('drag-over');});card.addEventListener('dragleave',()=>card.classList.remove('drag-over'));card.addEventListener('drop',async e=>{e.preventDefault();e.stopPropagation();card.classList.remove('drag-over');const files=e.dataTransfer.files;if(files.length>0){const idx=parseInt(card.dataset.index);if(isNaN(idx))return;const f=files[0],fpath=f.path||f.name;try{const r=await window.radialHub.file.resolveDrop(fpath);configData.tabs[currentTabIndex].items[idx]={icon:'ğŸ“',iconData:r.iconData||'',label:r.name||f.name.replace(/\.[^.]+$/,''),type:'launch',target:r.target||fpath};}catch(err){configData.tabs[currentTabIndex].items[idx]={icon:'ğŸ“',label:f.name.replace(/\.[^.]+$/,''),type:'launch',target:fpath};}editingSectorIndex=idx;renderSectorGrid();renderPreview();saveConfig();showToast('âœ… #'+(idx+1)+' '+t('placedAt'));}});});}

function selectSector(i){editingSectorIndex=(editingSectorIndex===i)?-1:i;renderSectorGrid();renderPreview();}
function updateSector(k,v){if(editingSectorIndex>=0)configData.tabs[currentTabIndex].items[editingSectorIndex][k]=v;}
function clearSector(i){configData.tabs[currentTabIndex].items[i]={icon:'â•',label:t('unset'),type:'launch',target:''};editingSectorIndex=-1;renderSectorGrid();renderPreview();saveConfig();showToast('ğŸ—‘ï¸ '+t('cleared'));}
function saveSector(){editingSectorIndex=-1;renderSectorGrid();renderPreview();saveConfig();showToast('âœ… '+t('savedMsg'));}

function renderHotkeyView(){const c=document.getElementById('hotkeyContent'),hk=configData.hotkeys||{};c.innerHTML=getHotkeyDefs().map(d=>'<div class="hotkey-row"><span class="hotkey-label">'+d.label+'</span><div class="hotkey-input" data-key="'+d.key+'" onclick="recordHotkey(this)">'+(hk[d.key]||t('unset'))+'</div></div>').join('');}
function recordHotkey(el){el.classList.add('recording');el.textContent=t('hotkeyRecording');const h=e=>{e.preventDefault();const p=[];if(e.ctrlKey)p.push('Ctrl');if(e.shiftKey)p.push('Shift');if(e.altKey)p.push('Alt');if(e.key&&!['Control','Shift','Alt'].includes(e.key))p.push(e.key===' '?'Space':e.key.length===1?e.key.toUpperCase():e.key);if(p.length>1||(!e.ctrlKey&&!e.shiftKey&&!e.altKey&&p.length===1)){const combo=p.join('+');el.textContent=combo;el.classList.remove('recording');configData.hotkeys[el.dataset.key]=combo;saveHotkeys();document.removeEventListener('keydown',h);}};document.addEventListener('keydown',h);}

function renderClipboardView(){const c=document.getElementById('clipboardContent'),cl=configData.clipboard||{};c.innerHTML='<div class="setting-row"><div class="setting-label-group"><span class="setting-label">'+(t('clipMonitor'))+'</span><span class="setting-desc">'+(t('clipMonitorDesc'))+'</span></div><div class="toggle '+(cl.enabled!==false?'on':'')+'" onclick="toggleClipSetting(this,\'enabled\')"><div class="toggle-knob"></div></div></div><div class="setting-row"><div class="setting-label-group"><span class="setting-label">'+(t('maxHistory'))+'</span></div><input class="setting-number" type="number" value="'+(cl.maxHistory||100)+'" min="10" max="1000" onchange="configData.clipboard.maxHistory=parseInt(this.value);saveClipSettings()"></div><div class="setting-row"><div class="setting-label-group"><span class="setting-label">'+(t('saveImages'))+'</span></div><div class="toggle '+(cl.saveImages!==false?'on':'')+'" onclick="toggleClipSetting(this,\'saveImages\')"><div class="toggle-knob"></div></div></div><div class="setting-row"><div class="setting-label-group"><span class="setting-label">'+(t('excludePasswords'))+'</span></div><div class="toggle '+(cl.excludePasswords!==false?'on':'')+'" onclick="toggleClipSetting(this,\'excludePasswords\')"><div class="toggle-knob"></div></div></div>';}
function toggleClipSetting(el,key){el.classList.toggle('on');if(!configData.clipboard)configData.clipboard={};configData.clipboard[key]=el.classList.contains('on');saveClipSettings();}
async function saveClipSettings(){await window.radialHub.config.set('clipboard',configData.clipboard);document.getElementById('statusText').textContent='âœ… '+t('clipSaved');}

async function renderAppearanceView(){
  const c=document.getElementById('appearanceContent'),ap=configData.appearance||{};
  let autoStart=true;try{autoStart=await window.radialHub.autoLaunch.get();}catch(e){}
  c.innerHTML='<div style="font-size:11px;color:#4a6cf7;font-weight:600;margin-bottom:8px">ğŸš€ '+(lang==='ja'?'èµ·å‹•':lang==='zh'?'å¯åŠ¨':lang==='fr'?'DÃ©marrage':'Startup')+'</div><div class="setting-row"><div class="setting-label-group"><span class="setting-label">'+t('autoStart')+'</span><span class="setting-desc">'+t('autoStartDesc')+'</span></div><div class="toggle '+(autoStart?'on':'')+'" onclick="toggleAutoStart(this)"><div class="toggle-knob"></div></div></div><div style="font-size:11px;color:#4a6cf7;font-weight:600;margin:16px 0 8px">ğŸ¨ '+t('appearance')+'</div><div class="setting-row"><div class="setting-label-group"><span class="setting-label">'+t('theme')+'</span><span class="setting-desc">'+t('themeDesc')+'</span></div><select class="setting-select" onchange="configData.appearance.theme=this.value;saveAppSettings()"><option value="dark" '+(ap.theme==='dark'||(!ap.theme)?'selected':'')+'>'+t('themeDark')+'</option><option value="light" '+(ap.theme==='light'?'selected':'')+'>'+t('themeLight')+'</option><option value="pink" '+(ap.theme==='pink'?'selected':'')+'>'+t('themePink')+'</option></select></div><div class="setting-row"><div class="setting-label-group"><span class="setting-label">'+t('menuSize')+'</span></div><input class="setting-number" type="number" value="'+(ap.menuSize||380)+'" step="20" onchange="configData.appearance.menuSize=parseInt(this.value);saveAppSettings()"></div><div class="setting-row"><div class="setting-label-group"><span class="setting-label">'+t('opacity')+'</span></div><input class="setting-number" type="number" value="'+(ap.opacity||95)+'" min="50" max="100" onchange="configData.appearance.opacity=parseInt(this.value);saveAppSettings()"></div><div class="setting-row"><div class="setting-label-group"><span class="setting-label">'+t('animation')+'</span></div><div class="toggle '+(ap.animation!==false?'on':'')+'" onclick="toggleAppSetting(this,\'animation\')"><div class="toggle-knob"></div></div></div><div style="font-size:11px;color:#4a6cf7;font-weight:600;margin:16px 0 8px">ğŸŒ '+t('language')+'</div><div class="setting-row"><div class="setting-label-group"><span class="setting-label">'+t('language')+'</span><span class="setting-desc">'+t('languageDesc')+'</span></div><select class="setting-select" onchange="configData.appearance.language=this.value;saveAppSettings();location.reload()"><option value="ja" '+(lang==="ja"?"selected":"")+'>æ—¥æœ¬èª</option><option value="en" '+(lang==="en"?"selected":"")+'>English</option><option value="fr" '+(lang==="fr"?"selected":"")+'>FranÃ§ais</option><option value="zh" '+(lang==="zh"?"selected":"")+'>ä¸­æ–‡</option></select></div>';
}
async function toggleAutoStart(el){el.classList.toggle('on');const enabled=el.classList.contains('on');await window.radialHub.autoLaunch.set(enabled);document.getElementById('statusText').textContent=enabled?'âœ… '+t('autoStart')+' ON':'âš« '+t('autoStart')+' OFF';}
function toggleAppSetting(el,key){el.classList.toggle('on');if(!configData.appearance)configData.appearance={};configData.appearance[key]=el.classList.contains('on');saveAppSettings();}
async function saveAppSettings(){await window.radialHub.config.set('appearance',configData.appearance);document.getElementById('statusText').textContent='âœ… '+t('appSaved');}

function switchPaletteTab(el){document.querySelectorAll('.palette-tab').forEach(t=>t.classList.remove('active'));el.classList.add('active');currentPaletteTab=el.dataset.pt;renderPalette();}
function renderPalette(){const c=document.getElementById('paletteContent');let html='';
if(currentPaletteTab==='templates'){html+='<div class="palette-section-title">'+t('commonTemplates')+' <span class="palette-add-btn" onclick="toggleNewTemplate()">ï¼‹ '+t('addNew')+'</span></div>';html+='<div class="new-template-wrap" id="newTemplateWrap"><textarea class="new-template-input" id="newTemplateInput" placeholder="'+t('newTemplatePlaceholder')+'"></textarea><div class="new-template-actions"><button class="btn btn-secondary" onclick="toggleNewTemplate()" style="padding:3px 8px;font-size:10px">'+t('cancel')+'</button><button class="btn btn-primary" onclick="addTemplate()" style="padding:3px 8px;font-size:10px">'+t('addNew')+'</button></div></div>';(configData.templates||[]).forEach((tpl,i)=>{const short=tpl.length>24?tpl.substring(0,24)+'...':tpl;const obj=JSON.stringify({icon:'ğŸ“',label:short,type:'text',target:tpl}).replace(/"/g,'&quot;');html+='<div class="palette-item" onmousedown="startDrag(event,'+obj+')"><span class="palette-item-icon">ğŸ“</span><div class="palette-item-info"><div class="palette-item-name">'+short+'</div><div class="palette-item-desc">'+t('dragToSlot')+'</div></div><button onclick="event.stopPropagation();deleteTemplate('+i+')" style="background:none;border:none;color:#ccc;cursor:pointer;font-size:12px">âœ•</button></div>';});if(!(configData.templates||[]).length)html+='<div style="text-align:center;padding:16px;color:#bbb;font-size:11px">'+t('noHistory')+'</div>';}
else if(currentPaletteTab==='launch'){const ssClip=JSON.stringify({icon:'âœ‚ï¸',label:t('captureClip'),type:'screenshot_clip',target:''}).replace(/"/g,'&quot;');const ssSave=JSON.stringify({icon:'ğŸ’¾',label:t('captureSave'),type:'screenshot_save',target:'D:\\Screenshots\\'}).replace(/"/g,'&quot;');html+='<div class="palette-section-title">ğŸ“· Screenshot</div>';html+='<div class="screenshot-card" onmousedown="startDrag(event,'+ssClip+')"><div class="screenshot-card-icon">âœ‚ï¸</div><div class="screenshot-card-info"><div class="screenshot-card-name">'+t('captureClip')+'</div><div class="screenshot-card-desc">'+t('pasteWithCtrlV')+'</div></div><span class="screenshot-card-badge">CLP</span></div>';html+='<div class="screenshot-card" onmousedown="startDrag(event,'+ssSave+')"><div class="screenshot-card-icon">ğŸ’¾</div><div class="screenshot-card-info"><div class="screenshot-card-name">'+t('captureSave')+'</div><div class="screenshot-card-desc">'+t('saveToFolder')+'</div></div><span class="screenshot-card-badge">FILE</span></div>';const tab=configData.tabs[currentTabIndex];html+='<div class="palette-section-title" style="margin-top:8px">'+t('registeredShortcuts')+' <span class="palette-add-btn" onclick="openBrowseModal()">ï¼‹ '+t('register')+'</span></div>';html+='<div class="drop-zone" id="paletteDropZone"><div class="drop-zone-icon">ğŸ“‚</div><div class="drop-zone-main">'+t('dropShortcutFolder')+'</div></div>';html+='<div class="dialog-btns"><div class="dialog-btn" onclick="dialogSelectFile(\'palette\')">ğŸ“„ '+t('selectFile')+'</div><div class="dialog-btn" onclick="dialogSelectFolder(\'palette\')">ğŸ“‚ '+t('selectFolder')+'</div></div>';(tab.registered||[]).forEach((reg,i)=>{html+='<div class="registered-item" onmousedown="startDragRegistered(event,'+i+')"><span class="registered-item-icon">'+iconHtml(reg.iconData||reg.icon,20)+'</span><div class="registered-item-info"><div class="registered-item-name">'+reg.label+'</div><div class="registered-item-path">'+reg.path+'</div></div><button class="registered-item-del" onclick="event.stopPropagation();deleteRegistered('+i+')">âœ•</button></div>';});}
else if(currentPaletteTab==='system'){html+='<div class="palette-section-title">'+t('systemFeatures')+'</div>';getSystemItems().forEach(item=>{const obj=JSON.stringify(item).replace(/"/g,'&quot;');const tc=item.type==='clipboard'?'type-clipboard':item.type==='templates'?'type-templates':'type-launch';const tl=item.type==='clipboard'?'CLP':item.type==='templates'?t('templates'):'SYS';html+='<div class="palette-item" onmousedown="startDrag(event,'+obj+')"><span class="palette-item-icon">'+item.icon+'</span><div class="palette-item-info"><div class="palette-item-name">'+item.label+'</div><div class="palette-item-desc">'+(item.target||t('builtIn'))+'</div></div><span class="palette-item-badge '+tc+'">'+tl+'</span></div>';});}
c.innerHTML=html;setTimeout(setupDropZones,0);}

function setupDropZones(){['paletteDropZone','modalDropZone'].forEach(id=>{const dz=document.getElementById(id);if(!dz)return;dz.addEventListener('dragover',e=>{e.preventDefault();e.stopPropagation();dz.classList.add('drag-active');});dz.addEventListener('dragleave',()=>dz.classList.remove('drag-active'));dz.addEventListener('drop',async e=>{e.preventDefault();e.stopPropagation();dz.classList.remove('drag-active');const files=e.dataTransfer.files;if(files.length>0){const f=files[0],fpath=f.path||f.name;if(id==='modalDropZone'){document.getElementById('browsePathInput').value=fpath;document.getElementById('browseNameInput').value=f.name.replace(/\.[^.]+$/,'');}else{try{const r=await window.radialHub.file.resolveDrop(fpath);registerShortcut('ğŸ“',r.name||f.name.replace(/\.[^.]+$/,''),r.target||fpath,r.iconData);}catch(e){registerShortcut('ğŸ“',f.name.replace(/\.[^.]+$/,''),fpath);}}}});});}

// ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ•ã‚©ãƒ«ãƒ€é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°
async function dialogSelectFile(mode){
  const r=await window.radialHub.dialog.openFile();
  if(!r)return;
  if(mode==='modal'){document.getElementById('browsePathInput').value=r.target;document.getElementById('browseNameInput').value=r.name;}
  else{registerShortcut('ğŸ“',r.name,r.target,r.iconData);}
}
async function dialogSelectFolder(mode){
  const r=await window.radialHub.dialog.openFolder();
  if(!r)return;
  if(mode==='modal'){document.getElementById('browsePathInput').value=r.target;document.getElementById('browseNameInput').value=r.name;}
  else{registerShortcut('ğŸ“‚',r.name,r.target,r.iconData);}
}

function toggleNewTemplate(){const w=document.getElementById('newTemplateWrap');if(w)w.classList.toggle('visible');}
function addTemplate(){const inp=document.getElementById('newTemplateInput');if(!inp||!inp.value.trim())return;if(!configData.templates)configData.templates=[];configData.templates.push(inp.value.trim());inp.value='';toggleNewTemplate();renderPalette();saveConfig();showToast('ğŸ“ '+t('addNew'));}
function deleteTemplate(i){configData.templates.splice(i,1);renderPalette();saveConfig();}
function registerShortcut(icon,label,path,iconData){if(!configData.tabs[currentTabIndex].registered)configData.tabs[currentTabIndex].registered=[];configData.tabs[currentTabIndex].registered.push({icon:icon,label,path,iconData:iconData||''});renderPalette();saveConfig();showToast('âœ… '+label+' '+t('register'));}
function deleteRegistered(i){configData.tabs[currentTabIndex].registered.splice(i,1);renderPalette();saveConfig();}
function openBrowseModal(){browseIcon='ğŸ“';document.getElementById('browseIconPreview').textContent=browseIcon;document.getElementById('browsePathInput').value='';document.getElementById('browseNameInput').value='';document.getElementById('browseModal').classList.add('visible');setTimeout(setupDropZones,0);}
function closeBrowseModal(){document.getElementById('browseModal').classList.remove('visible');}
function registerFromBrowse(){const p=document.getElementById('browsePathInput').value.trim(),n=document.getElementById('browseNameInput').value.trim()||t('newTab');if(!p){showToast('âš ï¸ '+t('enterPath'));return;}registerShortcut(browseIcon,n,p);closeBrowseModal();}
function onTabNameChange(){configData.tabs[currentTabIndex].name=document.getElementById('editTabName').value;renderTabList();saveConfig();}
function swapSector(a,b){const items=configData.tabs[currentTabIndex].items;if(b<0||b>=8)return;const tmp=items[a];items[a]=items[b];items[b]=tmp;editingSectorIndex=b;renderSectorGrid();renderPreview();saveConfig();}
function addNewTab(){configData.tabs.push({id:'tab'+Date.now(),name:t('newTab'),icon:'ğŸ“Œ',items:Array(8).fill(null).map(()=>({icon:'â•',label:t('unset'),type:'launch',target:''})),registered:[]});currentTabIndex=configData.tabs.length-1;editingSectorIndex=-1;renderAll();saveConfig();showToast('â• '+t('tabAdded'));}
function duplicateTab(){const c=JSON.parse(JSON.stringify(configData.tabs[currentTabIndex]));c.id='tab'+Date.now();c.name+=' ('+t('duplicate')+')';configData.tabs.splice(currentTabIndex+1,0,c);currentTabIndex++;renderAll();saveConfig();showToast('ğŸ“„ '+t('duplicated'));}
function deleteTab(){if(configData.tabs.length<=1){showToast('âš ï¸ '+t('lastTab'));return;}configData.tabs.splice(currentTabIndex,1);if(currentTabIndex>=configData.tabs.length)currentTabIndex--;editingSectorIndex=-1;renderAll();saveConfig();showToast('ğŸ—‘ï¸ '+t('deleted'));}
let dragData=null;const ghost=document.getElementById('dragGhost');
function startDragRegistered(e,regIdx){const tab=configData.tabs[currentTabIndex];const reg=tab.registered[regIdx];if(!reg)return;const data={icon:reg.icon||'ğŸ“',iconData:reg.iconData||'',label:reg.label,type:'launch',target:reg.path};startDrag(e,data);}
function startDrag(e,data){e.preventDefault();dragData=data;ghost.textContent=(data.icon&&data.icon.startsWith('data:')?'ğŸ“':data.icon)+' '+data.label;ghost.style.display='block';moveGhost(e);document.addEventListener('mousemove',moveGhost);document.addEventListener('mouseup',endDrag);const el=e.target.closest('.palette-item,.registered-item,.screenshot-card');if(el)el.classList.add('dragging');}
function moveGhost(e){ghost.style.left=(e.clientX+12)+'px';ghost.style.top=(e.clientY-10)+'px';}
function endDrag(e){ghost.style.display='none';document.removeEventListener('mousemove',moveGhost);document.removeEventListener('mouseup',endDrag);document.querySelectorAll('.dragging').forEach(el=>el.classList.remove('dragging'));document.querySelectorAll('.sector-card.drag-over').forEach(el=>el.classList.remove('drag-over'));const t=document.elementFromPoint(e.clientX,e.clientY),card=t?t.closest('.sector-card'):null;if(card&&dragData){const idx=parseInt(card.dataset.index);if(!isNaN(idx)){configData.tabs[currentTabIndex].items[idx]={...dragData};editingSectorIndex=idx;renderSectorGrid();renderPreview();saveConfig();showToast('âœ… #'+(idx+1)+'ï¼ˆ'+posNames[idx]+'ï¼‰ã«é…ç½®');}}dragData=null;}
document.addEventListener('mousemove',e=>{if(!dragData)return;document.querySelectorAll('.sector-card').forEach(card=>{const r=card.getBoundingClientRect();card.classList.toggle('drag-over',e.clientX>=r.left&&e.clientX<=r.right&&e.clientY>=r.top&&e.clientY<=r.bottom);});});
function buildEmojiGrid(){const g=document.getElementById('emojiGrid');emojis.forEach(e=>{const b=document.createElement('button');b.className='emoji-btn';b.textContent=e;b.onclick=()=>selectEmoji(e);g.appendChild(b);});}
function openEmojiPicker(t){emojiTarget=t;document.getElementById('emojiModal').classList.add('visible');}
function closeEmojiPicker(){document.getElementById('emojiModal').classList.remove('visible');}
function resetSectorIcon(){if(typeof editingSectorIndex==='number'&&editingSectorIndex>=0){configData.tabs[currentTabIndex].items[editingSectorIndex].iconData='';renderSectorGrid();renderPreview();saveConfig();showToast('ğŸ”„ '+t('iconReset'));}}
function selectEmoji(emoji){if(emojiTarget==='tab')configData.tabs[currentTabIndex].icon=emoji;else if(emojiTarget==='browse'){browseIcon=emoji;document.getElementById('browseIconPreview').textContent=emoji;}else if(typeof emojiTarget==='number'){configData.tabs[currentTabIndex].items[emojiTarget].icon=emoji;configData.tabs[currentTabIndex].items[emojiTarget].iconData='';}closeEmojiPicker();renderAll();saveConfig();}
function renderPreview(){const svg=document.getElementById('previewSvg');svg.innerHTML='';const cx=55,cy=55,inner=16,outer=50,tab=configData.tabs[currentTabIndex];if(!tab)return;tab.items.forEach((item,i)=>{const sa=(i*45-90-22.5)*Math.PI/180,ea=((i+1)*45-90-22.5)*Math.PI/180,ma=(sa+ea)/2;const d='M '+(cx+inner*Math.cos(sa))+' '+(cy+inner*Math.sin(sa))+' L '+(cx+outer*Math.cos(sa))+' '+(cy+outer*Math.sin(sa))+' A '+outer+' '+outer+' 0 0 1 '+(cx+outer*Math.cos(ea))+' '+(cy+outer*Math.sin(ea))+' L '+(cx+inner*Math.cos(ea))+' '+(cy+inner*Math.sin(ea))+' A '+inner+' '+inner+' 0 0 0 '+(cx+inner*Math.cos(sa))+' '+(cy+inner*Math.sin(sa))+' Z';const p=document.createElementNS('http://www.w3.org/2000/svg','path');p.setAttribute('d',d);p.setAttribute('class','preview-sector'+(i===editingSectorIndex?' highlight':''));svg.appendChild(p);const t=document.createElementNS('http://www.w3.org/2000/svg','text');t.setAttribute('x',cx+35*Math.cos(ma));t.setAttribute('y',cy+35*Math.sin(ma));t.setAttribute('text-anchor','middle');t.setAttribute('dominant-baseline','central');t.setAttribute('font-size','11');t.textContent=item.icon;svg.appendChild(t);});}
function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1800);}

function updateUILabels(){
  const ht=document.getElementById('headerTitle');if(ht)ht.innerHTML='âš™ï¸ '+t('settings');
  document.querySelectorAll('.sidebar-title').forEach((el,i)=>{if(i===0)el.textContent=t('businessTabs');else el.textContent=t('generalSettings');});
  const addBtn=document.querySelector('.tab-add-btn');if(addBtn)addBtn.textContent=t('addTab');
  const navHk=document.querySelector('#navHotkey .tab-item-name');if(navHk)navHk.textContent=t('hotkeys');
  const navCl=document.querySelector('#navClipboard .tab-item-name');if(navCl)navCl.textContent=t('clipboard');
  const navAp=document.querySelector('#navAppearance .tab-item-name');if(navAp)navAp.textContent=t('appearanceGeneral');
  const hkT=document.getElementById('hotkeyTitle');if(hkT)hkT.textContent=t('hotkeySettings');
  const hkD=document.getElementById('hotkeyDesc');if(hkD)hkD.textContent=t('hotkeyDesc');
  const clT=document.getElementById('clipTitle');if(clT)clT.textContent=t('clipboardSettings');
  const apT=document.getElementById('appTitle');if(apT)apT.textContent=t('appearanceSettings');
  const pH=document.getElementById('paletteHeader');if(pH)pH.innerHTML='ğŸ§© '+t('partsPalette');
  const ptT=document.getElementById('ptTemplates');if(ptT)ptT.textContent=t('templates');
  const ptL=document.getElementById('ptLaunch');if(ptL)ptL.textContent=t('launch');
  const ptS=document.getElementById('ptSystem');if(ptS)ptS.textContent=t('system');
  const edDesc=document.getElementById('editTabDesc');if(edDesc)edDesc.textContent=t('dragToSlot');
  const btnDup=document.getElementById('btnDuplicate');if(btnDup)btnDup.innerHTML='ğŸ“„ '+t('duplicate');
  const btnDel=document.getElementById('btnDelete');if(btnDel)btnDel.innerHTML='ğŸ—‘ï¸ '+t('delete');
  const msL=document.getElementById('menuSlotsLabel');if(msL)msL.innerHTML='ğŸ¯ '+t('menuSlots');
  const pvL=document.getElementById('previewLabel');if(pvL)pvL.textContent=lang==='ja'?'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼':lang==='zh'?'é¢„è§ˆ':lang==='fr'?'AperÃ§u':'Preview';
  const bmT=document.getElementById('browseModalTitle');if(bmT)bmT.innerHTML='ğŸ“‚ '+t('shortcutOrFolder');
  const bmD=document.getElementById('browseModalDesc');if(bmD)bmD.textContent=lang==='ja'?'ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã€ã¾ãŸã¯ãƒœã‚¿ãƒ³ã§é¸æŠ':lang==='zh'?'ä»èµ„æºç®¡ç†å™¨æ‹–æ”¾æˆ–ç‚¹å‡»æŒ‰é’®é€‰æ‹©':lang==='fr'?'Glisser-dÃ©poser ou sÃ©lectionner':'Drag & drop from explorer, or select with buttons';
  const mdT=document.getElementById('modalDropText');if(mdT)mdT.textContent=t('dropFileFolder');
  const msF=document.getElementById('modalSelectFile');if(msF)msF.innerHTML='ğŸ“„ '+t('selectFile');
  const msFo=document.getElementById('modalSelectFolder');if(msFo)msFo.innerHTML='ğŸ“‚ '+t('selectFolder');
  const miL=document.getElementById('manualInputLabel');if(miL)miL.textContent=t('orManualInput');
  const emT=document.getElementById('emojiModalTitle');if(emT)emT.textContent=lang==='ja'?'ã‚¢ã‚¤ã‚³ãƒ³ã‚’é¸æŠ':lang==='zh'?'é€‰æ‹©å›¾æ ‡':lang==='fr'?'Choisir icÃ´ne':'Select Icon';
  const emC=document.getElementById('emojiCancelBtn');if(emC)emC.textContent=t('cancel');
  const bcB=document.getElementById('browseCancelBtn');if(bcB)bcB.textContent=t('cancel');
  const brB=document.getElementById('browseRegisterBtn');if(brB)brB.innerHTML='âœ… '+t('register');
  const blN=document.getElementById('browseLabelName');if(blN)blN.textContent=t('displayName');
  const bnF=document.getElementById('browseNameField');if(bnF)bnF.placeholder=t('appName');
  const blI=document.getElementById('browseLabelIcon');if(blI)blI.textContent=t('icon');
  const ccL=document.getElementById('clickChangeLabel');if(ccL)ccL.textContent=t('clickToChange');
  document.querySelectorAll('.header-btn').forEach(b=>{if(b.textContent.includes('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ')||b.textContent.includes('Export'))b.innerHTML='ğŸ“¤ '+t('export');if(b.textContent.includes('ã‚¤ãƒ³ãƒãƒ¼ãƒˆ')||b.textContent.includes('Import'))b.innerHTML='ğŸ“¥ '+t('import');if(b.classList.contains('primary'))b.innerHTML='âœ• '+t('close');});
}

init();
</script>
</body>
</html>
